---
phase: 07-fnb-integration
plan: 02
type: execute
wave: 2
depends_on: ['07-01']
files_modified:
  - apps/accommodations/frontend/components/stay/RestaurantSection.tsx
  - apps/accommodations/frontend/app/stay/[code]/page.tsx
autonomous: true

must_haves:
  truths:
    - 'When has_linked_fnb is true, tapping Restaurant opens coffeeshop PWA in new tab'
    - 'When has_linked_fnb is false but F&B service items exist, static menu displays items with prices'
    - 'When no F&B data at all, restaurant section does not render'
    - 'Deep-link URL uses NEXT_PUBLIC_COFFEESHOP_BASE_URL env var with merchant slug'
    - 'RestaurantSection appears between QuickActions and ServicesCarousel in dashboard'
  artifacts:
    - path: 'apps/accommodations/frontend/components/stay/RestaurantSection.tsx'
      provides: 'Conditional F&B component (deep-link or static menu)'
      min_lines: 60
    - path: 'apps/accommodations/frontend/app/stay/[code]/page.tsx'
      provides: 'Dashboard shell with RestaurantSection integrated'
      contains: 'RestaurantSection'
  key_links:
    - from: 'RestaurantSection.tsx'
      to: 'coffeeshop PWA'
      via: 'window.open or anchor tag'
      pattern: 'NEXT_PUBLIC_COFFEESHOP_BASE_URL'
    - from: 'RestaurantSection.tsx'
      to: 'stay-api.ts'
      via: 'fetchServices for static menu'
      pattern: 'fetchServices'
    - from: 'page.tsx'
      to: 'RestaurantSection.tsx'
      via: 'component import and render'
      pattern: 'RestaurantSection'
---

<objective>
Build the RestaurantSection component with conditional rendering: deep-link to coffeeshop PWA when property has linked F&B, or inline static menu from service items when it does not. Wire into dashboard between QuickActions and ServicesCarousel.

Purpose: FNB-01 (deep-link), FNB-03 (static menu), and success criteria 2, 3, 5 (deep-link works, static menu shows, coffeeshop opens).
Output: RestaurantSection.tsx component and updated dashboard page.
</objective>

<execution_context>
@/Users/gianfrancodagostino/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gianfrancodagostino/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-fnb-integration/07-RESEARCH.md
@.planning/phases/07-fnb-integration/07-CONTEXT.md
@.planning/phases/07-fnb-integration/07-01-SUMMARY.md

Key existing files (read before implementing):
@apps/accommodations/frontend/app/stay/[code]/page.tsx
@apps/accommodations/frontend/components/stay/ServicesCarousel.tsx
@apps/accommodations/frontend/components/stay/LocalDeals.tsx
@apps/accommodations/frontend/types/stay.ts
@apps/accommodations/frontend/lib/stay-api.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: RestaurantSection component</name>
  <files>apps/accommodations/frontend/components/stay/RestaurantSection.tsx</files>
  <action>
Create RestaurantSection.tsx following the section component pattern (ServicesCarousel.tsx, LocalDeals.tsx).

The component receives props from the dashboard:

```typescript
interface RestaurantSectionProps {
  hasLinkedFnb: boolean;
  linkedFnbSlug: string | null;
  bookingCode: string;
  token: string;
}
```

**Conditional behavior:**

A) When `hasLinkedFnb && linkedFnbSlug`:

- Render a card with ForkKnife icon (Phosphor, weight="duotone", size=24, color #E07A5F)
- Title: "Restaurant" with subtitle "View our menu"
- Entire card is an `<a>` tag linking to coffeeshop PWA
- URL: `${process.env.NEXT_PUBLIC_COFFEESHOP_BASE_URL || ''}/${linkedFnbSlug}`
- Opens in new tab: `target="_blank" rel="noopener noreferrer"`
- Include a CaretRight icon on the right side (Phosphor)
- Style: rounded-2xl, white bg, border border-[#E8E2D9], shadow-sm, hover:shadow-md transition
- Section wrapper: `<section className="mb-5 px-4">`

B) When NOT linked but F&B service items exist:

- Fetch services using `fetchServices(bookingCode, token)` from stay-api
- Filter categories to F&B slugs: `['breakfast', 'restaurant', 'minibar', 'bar', 'cafe']`
- Match by checking if category name (lowercased) includes any of these slugs
- Show loading skeleton while fetching (same pattern as ServicesCarousel)
- Render as a card with ForkKnife icon header and expandable category list
- Each category shows its items with name, description (if exists), price (use formatPrice pattern from ServicesCarousel -- copy the helper and ZERO_DECIMAL_CURRENCIES set into this file)
- Show item image thumbnails if `item.image` exists
- If no F&B items found after filtering, render nothing (return null)

C) When no F&B data at all (not linked AND no F&B service items):

- Return null -- section doesn't appear

**Important:**

- Use 'use client' directive
- Import ForkKnife and CaretRight from '@phosphor-icons/react'
- Follow the exact color palette from existing components (#2D2016 text, #8B7355 secondary, #E07A5F accent, #3D8B87 price, #FAF8F5 bg)
- The static menu is displayed INLINE within the section, NOT as a separate route or modal (per CONTEXT.md and RESEARCH.md pitfall 3)
  </action>
  <verify>
  Read RestaurantSection.tsx and confirm:
- ForkKnife icon imported from @phosphor-icons/react
- Deep-link branch uses NEXT_PUBLIC_COFFEESHOP_BASE_URL env var
- Static menu branch calls fetchServices and filters to F&B categories
- formatPrice handles zero-decimal currencies
- Component returns null when no F&B data
- 'use client' directive present
  </verify>
  <done>RestaurantSection.tsx renders deep-link card for linked F&B properties and inline static menu for non-linked properties with F&B services. Returns null when no F&B data exists.</done>
  </task>

<task type="auto">
  <name>Task 2: Wire RestaurantSection into dashboard and verify build</name>
  <files>apps/accommodations/frontend/app/stay/[code]/page.tsx</files>
  <action>
1. In page.tsx, add import:
   `import RestaurantSection from '@/components/stay/RestaurantSection';`

2. Insert RestaurantSection between QuickActions and ServicesCarousel (around line 100):

   ```tsx
   <RestaurantSection
     hasLinkedFnb={propertyExtended?.hasLinkedFnb ?? false}
     linkedFnbSlug={propertyExtended?.linkedFnbSlug ?? null}
     bookingCode={params.code}
     token={token!}
   />
   ```

3. Add NEXT_PUBLIC_COFFEESHOP_BASE_URL to .env.local (or .env.example if it exists) with value `http://localhost:3004` for local development. Check if .env.local or .env.example exists first -- if neither exists, skip this step (the component defaults to empty string).

4. Run full build to verify everything compiles:
   `cd apps/accommodations/frontend && npx next build`

If build fails, fix any TypeScript or import errors.
</action>
<verify>
Run: `cd /Users/gianfrancodagostino/Desktop/gudbro-verticals/apps/accommodations/frontend && npx next build`
Build must succeed with no errors.
Read page.tsx and confirm RestaurantSection is imported and placed between QuickActions and ServicesCarousel.
</verify>
<done>Dashboard page includes RestaurantSection between QuickActions and ServicesCarousel. Accommodations frontend builds successfully with zero errors.</done>
</task>

</tasks>

<verification>
- RestaurantSection.tsx exists at apps/accommodations/frontend/components/stay/RestaurantSection.tsx
- Component handles three states: deep-link (linked F&B), static menu (unlinked with F&B items), and hidden (no F&B data)
- Dashboard page imports and renders RestaurantSection between QuickActions and ServicesCarousel
- Deep-link uses NEXT_PUBLIC_COFFEESHOP_BASE_URL env var
- `cd apps/accommodations/frontend && npx next build` succeeds
</verification>

<success_criteria>

- FNB-01 complete: "Restaurant" card deep-links to coffeeshop PWA when has_linked_fnb=true
- FNB-03 complete: Static menu shows F&B service items with prices when has_linked_fnb=false
- Success criterion 2: Deep-link card opens coffeeshop PWA in new tab
- Success criterion 3: Static menu displays items with prices (view-only)
- Success criterion 5: Deep-link URL constructed correctly with merchant slug
- Full build passes
  </success_criteria>

<output>
After completion, create `.planning/phases/07-fnb-integration/07-02-SUMMARY.md`
</output>
