import * as React from 'react'
import { cn } from '@/lib/utils/cn'

export interface AllergenIconProps {
  /** Icon name (matches SVG filename without 'circle-' prefix and '.svg' extension) */
  name: string
  /** Size in pixels */
  size?: number
  /** Additional className */
  className?: string
  /** Use 'circle-' prefix variant (default: true) */
  useCircle?: boolean
  /** Color scheme based on filter type */
  colorScheme?: 'allergen' | 'intolerance' | 'diet' | 'custom'
  /** Custom background color (hex/rgb) */
  customBgColor?: string
  /** Custom icon color (hex/rgb) */
  customIconColor?: string
}

/**
 * AllergenIcon Component - Colored Version
 *
 * Displays professional SVG allergen icons with intelligent color coding.
 * Icons are displayed with colored circular backgrounds and white/contrast icons.
 *
 * Color Schemes:
 * - allergen: Red/Orange (danger, life-threatening)
 * - intolerance: Amber/Yellow (caution, discomfort)
 * - diet: Green/Blue (lifestyle, preference)
 *
 * @example
 * <AllergenIcon name="gluten" size={24} colorScheme="allergen" />
 * <AllergenIcon name="lactose" size={32} colorScheme="intolerance" />
 * <AllergenIcon name="vegan" size={20} colorScheme="diet" />
 */
export function AllergenIcon({
  name,
  size = 24,
  useCircle = true,
  className,
  colorScheme = 'allergen',
  customBgColor,
  customIconColor,
}: AllergenIconProps) {
  const prefix = useCircle ? 'circle-' : ''
  const iconPath = `/icons/allergens/${prefix}${name}.svg`

  // Color palette based on filter type
  const getColors = () => {
    if (customBgColor && customIconColor) {
      return { bg: customBgColor, icon: customIconColor }
    }

    const colorMap = {
      allergen: {
        bg: '#EF4444', // red-500 - danger
        icon: '#FFFFFF',
      },
      intolerance: {
        bg: '#F59E0B', // amber-500 - caution
        icon: '#FFFFFF',
      },
      diet: {
        bg: '#10B981', // emerald-500 - positive
        icon: '#FFFFFF',
      },
      custom: {
        bg: customBgColor || '#6B7280', // gray-500 default
        icon: customIconColor || '#FFFFFF',
      },
    }

    return colorMap[colorScheme]
  }

  const colors = getColors()

  return (
    <div
      className={cn(
        'inline-flex items-center justify-center rounded-full flex-shrink-0',
        className
      )}
      style={{
        width: size,
        height: size,
        minWidth: size,
        minHeight: size,
        backgroundColor: colors.bg,
        padding: size * 0.15, // 15% padding for better icon spacing
      }}
    >
      <img
        src={iconPath}
        alt={`${name} icon`}
        style={{
          width: '100%',
          height: '100%',
          filter: 'brightness(0) invert(1)', // Makes SVG white
        }}
      />
    </div>
  )
}

/**
 * Helper function to map filter IDs to icon names
 */
export function getIconNameFromFilterId(filterId: string): string | null {
  const iconMap: Record<string, string> = {
    // Allergens
    'gluten': 'gluten',
    'cereal': 'cereal',
    'wheat': 'free-from-wheat',
    'barley': 'free-from-barley',
    'rye': 'free-from-rye',
    'oats': 'free-from-oats',
    'crustaceans': 'crustaceans',
    'eggs': 'eggs',
    'fish': 'fish',
    'peanuts': 'peanuts',
    'soy': 'soy',
    'soya': 'soya',
    'milk': 'milk',
    'lactose': 'free-from-lactose',
    'nuts': 'nuts',
    'celery': 'celery',
    'mustard': 'mustard',
    'sesame': 'sesame',
    'so2': 'so2',
    'sulphur-dioxide': 'so2',
    'lupin': 'lupin',
    'molluscs': 'molluscs',

    // SEA / Korea Additional (Generated by NanoBanana AI - 2025-11-23)
    'shellfish': 'shellfish',
    'squid': 'squid',
    'shrimp': 'shrimp',
    'shrimp-paste': 'shrimp',
    'crab': 'crab',
    'sulphites': 'sulphites',

    // Additional allergens (using similar icons)
    'sesame-oil': 'sesame',
    'peanut-oil': 'peanuts',
    'msg-allergen': 'so2', // Using sulphites icon as placeholder
    'buckwheat': 'cereal',
    'mackerel': 'fish',
    'pork-allergen': 'milk', // Placeholder - no specific icon
    'peach': 'nuts', // Placeholder - fruit allergen
    'tomato': 'celery', // Placeholder - vegetable allergen
    'chicken': 'eggs', // Related animal product
    'beef': 'milk', // Related animal product

    // Intolerances
    'gluten-sensitivity': 'free-from-gluten',
    'fodmap': 'cereal', // Placeholder - grain related
    'histamine': 'fish', // Often in aged/fermented foods
    'fructose': 'soya', // Placeholder - sugar related
    'caffeine': 'so2', // Placeholder - sensitivity
    'alcohol': 'sulphites', // Wine/alcohol related
    'msg-intolerance': 'so2', // Same as msg-allergen
    'sulphites-sensitivity': 'free-from-sulphur-dioxide',
    'spiciness': 'mustard', // Spicy related

    // Diets
    'vegan': 'vegan',
    'vegetarian': 'vegetarian',
    'halal': 'halal',
    'kosher': 'kosher',
    'low-carb': 'low-carb',
    'pork-free': 'halal', // Similar to halal restrictions
    'buddhist': 'vegetarian', // Often vegetarian
    'pescatarian': 'fish', // Pescatarian allows fish
    'gluten-free': 'gluten', // Simple gluten icon (no text)
    'dairy-free': 'milk', // Simple milk icon (no text)
    'nut-free': 'nuts',

    // Backward compatibility: underscore variants (DEPRECATED - use hyphen instead)
    'gluten_free': 'free-from-gluten',
    'dairy_free': 'free-from-lactose',
    'nut_free': 'nuts',
    'low_carb': 'low-carb',
  }

  return iconMap[filterId] || null
}
