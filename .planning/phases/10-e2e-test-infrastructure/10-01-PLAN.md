---
phase: 10-e2e-test-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - tests/e2e/shared/vertical-registry.ts
  - tests/e2e/shared/base-pwa-page.ts
  - tests/e2e/shared/fixtures.ts
  - tests/e2e/shared/viewport-helpers.ts
autonomous: true

must_haves:
  truths:
    - 'Shared fixtures are importable by any test file in tests/e2e/verticals/'
    - 'BasePwaPage provides reusable smoke check methods (goto, expectPageLoads, expectNoConsoleErrors, expectNavigationVisible, expectTitle)'
    - 'Vertical registry maps all 8 verticals to port, baseURL, routes, and pnpmFilter'
    - 'Viewport helpers export mobile and desktop device presets from Playwright built-in devices'
  artifacts:
    - path: 'tests/e2e/shared/vertical-registry.ts'
      provides: 'Vertical config registry (8 verticals with port, baseURL, routes)'
      exports: ['VERTICALS', 'VERTICAL_SLUGS', 'VerticalConfig']
    - path: 'tests/e2e/shared/base-pwa-page.ts'
      provides: 'BasePwaPage class with smoke check methods'
      exports: ['BasePwaPage']
    - path: 'tests/e2e/shared/fixtures.ts'
      provides: 'Extended test object with pwaPage and verticalConfig fixtures'
      exports: ['test', 'expect']
    - path: 'tests/e2e/shared/viewport-helpers.ts'
      provides: 'Mobile and desktop viewport presets'
      exports: ['VIEWPORTS', 'ViewportName']
  key_links:
    - from: 'tests/e2e/shared/fixtures.ts'
      to: 'tests/e2e/shared/base-pwa-page.ts'
      via: 'import BasePwaPage'
      pattern: 'import.*BasePwaPage.*from.*base-pwa-page'
    - from: 'tests/e2e/shared/fixtures.ts'
      to: 'tests/e2e/shared/vertical-registry.ts'
      via: 'import VerticalConfig'
      pattern: 'import.*VerticalConfig.*from.*vertical-registry'
---

<objective>
Create shared test utilities for per-vertical E2E smoke testing: vertical registry, BasePwaPage, fixtures, and viewport helpers.

Purpose: These shared modules are the foundation that all vertical smoke tests will import. They centralize vertical config (ports, URLs, routes) and provide reusable page object methods for common smoke checks (page load, console errors, navigation visibility).

Output: 4 new TypeScript files in `tests/e2e/shared/` that are ready to be consumed by Plan 02's smoke tests and playwright config.
</objective>

<execution_context>
@/Users/gianfrancodagostino/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gianfrancodagostino/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-e2e-test-infrastructure/10-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create vertical registry and viewport helpers</name>
  <files>tests/e2e/shared/vertical-registry.ts, tests/e2e/shared/viewport-helpers.ts</files>
  <action>
Create `tests/e2e/shared/` directory.

Create `tests/e2e/shared/vertical-registry.ts` with:

- `VerticalConfig` interface: `name` (string), `slug` (string), `port` (number), `baseURL` (string), `pnpmFilter` (string), `routes` (object with `home: string` and `[key: string]: string`)
- `VERTICALS` record mapping all 8 verticals with their exact config from the research:
  - coffeeshop: port 3004, @gudbro/coffeeshop, routes: home=/
  - accommodations: port 3028, @gudbro/accommodations-frontend, routes: home=/, stay=/stay
  - tours: port 3026, @gudbro/tours-frontend, routes: home=/
  - wellness: port 3003, @gudbro/wellness-frontend, routes: home=/, services=/services, staff=/staff
  - laundry: port 3030, @gudbro/laundry-frontend, routes: home=/, services=/services
  - pharmacy: port 3031, @gudbro/pharmacy-frontend, routes: home=/, products=/products, search=/search
  - workshops: port 3032, @gudbro/workshops-frontend, routes: home=/, workshops=/workshops
  - gym: port 3033, @gudbro/gym-frontend, routes: home=/, courses=/courses, passes=/passes
- `VERTICAL_SLUGS` array derived from `Object.keys(VERTICALS)`
- Export all three: `VerticalConfig`, `VERTICALS`, `VERTICAL_SLUGS`

Create `tests/e2e/shared/viewport-helpers.ts` with:

- Import `devices` from `@playwright/test`
- Export `VIEWPORTS` const with `mobile: devices['Pixel 5']` and `desktop: devices['Desktop Chrome']`
- Export `ViewportName` type as `keyof typeof VIEWPORTS`
  </action>
  <verify>
  Run: `npx tsc --noEmit tests/e2e/shared/vertical-registry.ts tests/e2e/shared/viewport-helpers.ts` or verify via import in next task. At minimum, confirm the files exist and export the expected symbols by checking the TypeScript compiles without errors.
  </verify>
  <done>
  `vertical-registry.ts` exports `VerticalConfig`, `VERTICALS` (8 entries), and `VERTICAL_SLUGS`. `viewport-helpers.ts` exports `VIEWPORTS` (mobile + desktop) and `ViewportName` type.
  </done>
  </task>

<task type="auto">
  <name>Task 2: Create BasePwaPage and shared fixtures</name>
  <files>tests/e2e/shared/base-pwa-page.ts, tests/e2e/shared/fixtures.ts</files>
  <action>
Create `tests/e2e/shared/base-pwa-page.ts` with:
- Import `Page`, `Locator`, `expect` from `@playwright/test`
- Import `VerticalConfig` from `./vertical-registry`
- `BasePwaPage` class with:
  - Constructor taking `page: Page` and `config: VerticalConfig`, storing both as `readonly`
  - `goto(path?: string)`: navigates to `path` or `this.config.routes.home`
  - `expectPageLoads()`: navigates to home, asserts `response?.status()` is 200
  - `expectNoConsoleErrors()`: sets up `page.on('console')` listener for errors, navigates to home, waits for `networkidle`, filters benign errors (favicon, next-dev, hydration), asserts no real errors remain
  - `expectNavigationVisible()`: locates `nav, header, [role="navigation"]` first match, asserts visible with 10s timeout
  - `expectTitle()`: asserts page has non-empty title via `toHaveTitle(/.+/)`

Create `tests/e2e/shared/fixtures.ts` with:

- Import `test as base` from `@playwright/test`
- Import `BasePwaPage` from `./base-pwa-page`
- Import `VERTICALS`, `VerticalConfig` from `./vertical-registry`
- Define `PwaFixtures` type with `verticalConfig: VerticalConfig` and `pwaPage: BasePwaPage`
- Export `test` via `base.extend<PwaFixtures>()`:
  - `verticalConfig`: marked as `{ option: true }`, throws error "verticalConfig must be overridden per project" (will be provided by project config in Plan 02)
  - `pwaPage`: async fixture that creates `new BasePwaPage(page, verticalConfig)` and calls `use(pwaPage)`
- Re-export `expect` from `@playwright/test`
  </action>
  <verify>
  Run: `npx tsc --noEmit tests/e2e/shared/base-pwa-page.ts tests/e2e/shared/fixtures.ts` (or check that all 4 shared files compile together). Verify the `test` export from fixtures.ts is a valid Playwright test object by confirming the type extends the base test.
  </verify>
  <done>
  `base-pwa-page.ts` exports `BasePwaPage` with 5 smoke check methods. `fixtures.ts` exports extended `test` object with `verticalConfig` and `pwaPage` fixtures, plus re-exported `expect`.
  </done>
  </task>

</tasks>

<verification>
All 4 files exist in `tests/e2e/shared/`:
1. `vertical-registry.ts` - exports VERTICALS with 8 entries, VERTICAL_SLUGS, VerticalConfig
2. `base-pwa-page.ts` - exports BasePwaPage with goto, expectPageLoads, expectNoConsoleErrors, expectNavigationVisible, expectTitle
3. `fixtures.ts` - exports extended test object with pwaPage/verticalConfig fixtures + expect
4. `viewport-helpers.ts` - exports VIEWPORTS and ViewportName

TypeScript compiles without errors for all 4 files.
No existing test files modified.
</verification>

<success_criteria>

- 4 new files created in tests/e2e/shared/
- All files compile without TypeScript errors
- Exports are correctly structured for consumption by Plan 02
- No existing files in tests/e2e/ were modified
  </success_criteria>

<output>
After completion, create `.planning/phases/10-e2e-test-infrastructure/10-01-SUMMARY.md`
</output>
