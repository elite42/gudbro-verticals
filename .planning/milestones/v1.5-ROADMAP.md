# Milestone v1.5: Frictionless Guest Access + Accommodations Polish

**Status:** SHIPPED 2026-02-02
**Phases:** 25-39
**Total Plans:** 35

## Overview

Replace booking-code verification with room-based QR access, progressive authentication for paid actions, owner-configurable security levels, document upload with GDPR compliance, multi-zone WiFi display, PLUS comprehensive bug fixes and feature additions from manual testing session (13 bugs, 38 features across guest PWA, backoffice owner dashboard, service ordering, Tourist Concierge, and guest lifecycle).

## Phases

### Phase 25: Room Code Foundation

**Goal**: Guests scan a permanent room QR and immediately access WiFi credentials and property info without any login or verification
**Depends on**: Phase 24 (v1.4 complete)
**Plans**: 2 plans

Plans:

- [x] 25-01: Database schema + room code generation + resolve_room_access() SECURITY DEFINER function
- [x] 25-02: /stay/room/[roomCode] route + browse-tier JWT + useRoomSession hook + QR generator update

### Phase 26: Progressive Authentication

**Goal**: Guests can place orders and access paid services after seamless inline verification that upgrades their session without page reload
**Depends on**: Phase 25
**Plans**: 2 plans

Plans:

- [x] 26-01: Backend: migration (PIN + verification method), verify endpoint, requireFullAccess guard, tier gating on orders
- [x] 26-02: Frontend: InlineVerification bottom sheet, useRoomSession upgrade, room dashboard services + verification trigger

### Phase 27: Owner Security Configuration

**Goal**: Property owners can select a security preset that matches their property type, with sensible defaults and optional customization
**Depends on**: Phase 26
**Plans**: 2 plans

Plans:

- [x] 27-01: Migration 090 (access_settings JSONB + resolve_room_access update) + backoffice security settings page with preset selector and action toggles
- [x] 27-02: Frontend integration: room resolve returns access_settings, room dashboard uses isActionGated() for conditional verification

### Phase 28: Document Upload + Visa Tracking

**Goal**: Guests can upload passport and visa documents from the dashboard, with automatic visa expiry reminders and GDPR-compliant auto-deletion
**Depends on**: Phase 26 (requires verified session for uploads)
**Plans**: 2 plans

Plans:

- [x] 28-01: Database migration (accom_guest_documents + storage bucket + property retention columns) + API routes (upload URL, list, download, delete) + cron job (visa reminders + GDPR auto-delete)
- [x] 28-02: Image processing (HEIC + compression + blur detection) + guest upload UI (consent, camera, upload flow) + visa expiry alert + backoffice document urgency dashboard + booking detail integration

### Phase 29: Multi-Zone WiFi

**Goal**: Guests see WiFi credentials organized by zone, with their room network highlighted prominently
**Depends on**: Phase 25 (uses room resolution infrastructure)
**Plans**: 2 plans

Plans:

- [x] 29-01: Migration 092 (wifi_zones JSONB + room override columns + data migration) + backoffice WiFi zone management UI + property/rooms API updates
- [x] 29-02: WifiZoneInfo types + buildWifiInfo() shared helper + 4 guest API route updates + multi-zone WifiCard component + email template update

### Phase 30: Shared Module Audit

**Goal**: A comprehensive catalog of reusable modules across all verticals exists, enabling informed reuse decisions for all subsequent phases
**Depends on**: Nothing (informational, no code changes)
**Plans**: 1 plan

Plans:

- [x] 30-01: Audit codebase shared modules and produce SHARED-MODULE-CATALOG.md

### Phase 31: Bug Fixes + Image Foundation

**Goal**: All 9 identified bugs from manual testing are fixed and image upload infrastructure is established for services, items, and WiFi QR codes
**Depends on**: Phase 30
**Plans**: 2 plans

Plans:

- [x] 31-01: PWA bug fixes (BUG-01 through BUG-08) + QR code extraction from backoffice to shared util (INF-02)
- [x] 31-02: Image upload infrastructure (property-images storage bucket, accom_property_images table, image compression) + room image upload fix (BUG-09)

### Phase 32: Owner Dashboard Enhancements

**Goal**: Property owners have a complete, professional dashboard with Gantt calendar, onboarding wizard, structured policies, and full property data management
**Depends on**: Phase 31
**Plans**: 4 plans

Plans:

- [x] 32-01: Gantt calendar component + booking history component + room floor/level field + migrations
- [x] 32-02: Onboarding wizard + structured policies component + property data form component
- [x] 32-03: Wire GanttCalendar into calendar page + add History tab to bookings page
- [x] 32-04: Wire StructuredPolicies + PropertyDataForm into settings page

### Phase 33: Guest Dashboard Redesign

**Goal**: The guest in-stay dashboard uses a modern card-based layout with clear navigation hierarchy
**Depends on**: Phase 31
**Plans**: 2 plans

Plans:

- [x] 33-01: DashboardGrid + DashboardCard components, card-based homepage layout, WiFi dismiss/recover logic
- [x] 33-02: HouseRulesSheet + Contact Host in header + ProfileView + BottomNav restructure

### Phase 34: Service Expansion + Minibar

**Goal**: The service catalog is visually compelling with large photos and clear pricing, minibar self-service enables trust-based consumption tracking
**Depends on**: Phase 33
**Plans**: 5 plans

Plans:

- [x] 34-01: Service catalog redesign (large photos, add-to-cart, included-in-rate badge)
- [x] 34-02: Service catalog vertical card layout with included-in-rate support
- [x] 34-03: OrderDetailSheet and OrderListView with category-filtered tabs
- [x] 34-04: Minibar self-service (migration 096, types, API, mark-consumed UI)
- [x] 34-05: F&B catalog import picker + minibar wiring into dashboard

### Phase 35: Guest Feedback System

**Goal**: Guests can report issues during their stay and provide structured post-stay ratings with AI pipeline
**Depends on**: Phase 33
**Plans**: 2 plans

Plans:

- [x] 35-01: Database migration + API routes + guest feedback form + dashboard card + backoffice queue
- [x] 35-02: Post-checkout cron + star rating form + AI feedback pipeline + aggregate dashboard

### Phase 36: Guest Requests + Concierge

**Goal**: Tourist Concierge hub as central discovery point with emergency/safety/culture/transport sections
**Depends on**: Phase 33
**Plans**: 3 plans

Plans:

- [x] 36-01: DB migration + BottomNav center button + ConciergeHub overlay + backoffice toggles
- [x] 36-02: Emergency contacts + safety tips + cultural tips + recommended apps + useful numbers page
- [x] 36-03: Explore/Map page with local attractions and cross-vertical deep-links

### Phase 37: Conventions + Vouchers

**Goal**: Conventions system adapted for accommodations with benefit scoping and voucher validation
**Depends on**: Phase 34
**Plans**: 2 plans

Plans:

- [x] 37-01: Convention schema adaptation (benefit_scope, voucher validation RPC) + booking flow integration
- [x] 37-02: Convention partner cards in guest dashboard + backoffice conventions view

### Phase 38: Guest Lifecycle

**Goal**: Platform recognizes returning guests, supports checkout upsells, alerts about visa issues, connects to delivery services
**Depends on**: Phase 28, Phase 34
**Plans**: 2 plans

Plans:

- [x] 38-01: Returning guest detection + visa expiry alert + early/late checkout request flow + guest country field
- [x] 38-02: Delivery apps section (Grab, ShopeeFood, Baemin cards with deep-links)

### Phase 39: Polish + Analytics

**Goal**: Order performance tracked with actionable metrics, guests receive digital receipts
**Depends on**: Phase 34
**Plans**: 2 plans

Plans:

- [x] 39-01: Order performance tracking: migration 101 + timestamp recording + analytics API + counters panel
- [x] 39-02: Guest receipt confirmation: settings toggle + PWA receipt view + confirm action

---

## Milestone Summary

**Key Decisions:**

- Permanent room codes with date-based booking resolution (QR never expires)
- Two-tier JWT (browse/full) with inline progressive authentication
- Security presets (Family/Standard/Structured) with per-action gating
- Card-based dashboard layout replacing text wall
- Tourist Concierge as full-screen overlay (not page)
- Country-keyed concierge data (ISO code registry)
- Separate validate_accommodation_voucher() RPC (coffeeshop backward compat)
- Multi-signal returning guest detection (3 OR signals, never name alone)
- Self-service minibar auto-confirm matching existing automation patterns
- Feedback token reuses JWT secret with type='feedback' claim

**Issues Resolved:**

- 9 bugs from manual testing session (guest name, bottom nav, homepage, icons, time format, images, currency, WiFi QR, room upload)
- Pre-existing @shared/ module resolution errors documented as tech debt
- REQUIREMENTS.md traceability gaps (DOC-01-05, OWN-01-09, GXP-01/04 marked Pending but phases completed)

**Issues Deferred:**

- Captive portal WiFi integration (hardware domain)
- OCR passport extraction (ML complexity)
- NA17 police report export (follow-up after document upload validated)
- Dashboard section reordering (v2+ nice-to-have)

**Technical Debt Incurred:**

- Client-side document filtering in backoffice (could be server-side) — Low
- feedback-screenshots storage bucket needs manual creation in Supabase — Low
- OrderPerformancePanel returns null on error (silent fail) — Info
- ADMIN_API_KEY auth pattern needs migration to session-based auth
- Migrations 095-101 need to be applied to live database

---

_For current project status, see .planning/ROADMAP.md_
