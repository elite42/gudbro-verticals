---
phase: 30-shared-module-audit
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/30-shared-module-audit/SHARED-MODULE-CATALOG.md
autonomous: true

must_haves:
  truths:
    - 'Catalog lists every shared workspace package (8 packages) with status classification'
    - 'Catalog lists every duplicated pattern across vertical PWAs with divergence assessment'
    - 'Catalog lists every extractable backoffice module with reuse potential'
    - "Each 'needs adaptation' entry documents specific changes required for accommodations"
    - 'Phase Dependency Matrix maps phases 31-39 to required shared modules'
    - "Import path examples are included for all 'ready' modules"
  artifacts:
    - path: '.planning/phases/30-shared-module-audit/SHARED-MODULE-CATALOG.md'
      provides: 'Complete shared module catalog for phases 31-39'
      contains: '## Phase Dependency Matrix'
  key_links: []
---

<objective>
Audit the entire codebase to produce a comprehensive catalog of shared/reusable modules across all verticals, classifying each as ready / needs adaptation / to-build. This catalog enables phases 31-39 to make instant build-vs-reuse decisions without re-investigating the codebase.

Purpose: Phases 31-39 span bug fixes, dashboard redesign, service expansion, feedback, concierge, conventions, lifecycle, and polish. Many of these need modules that already exist somewhere in the codebase (QR generation, image utils, feedback pipeline, currency conversion, notification dispatch). Without a catalog, each phase plan would waste time rediscovering what exists. This one-time audit front-loads that investigation.

Output: `.planning/phases/30-shared-module-audit/SHARED-MODULE-CATALOG.md`
</objective>

<execution_context>
@/Users/gianfrancodagostino/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gianfrancodagostino/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/30-shared-module-audit/30-CONTEXT.md
@.planning/phases/30-shared-module-audit/30-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit codebase and produce SHARED-MODULE-CATALOG.md</name>
  <files>.planning/phases/30-shared-module-audit/SHARED-MODULE-CATALOG.md</files>
  <action>
Audit the codebase by scanning ALL shared and app-specific directories to produce a comprehensive catalog document. The research file (30-RESEARCH.md) provides a strong starting inventory — verify each entry against the actual codebase and add anything missed.

**Step 1: Verify workspace packages (shared/)**

Scan each workspace package directory and verify:

- `shared/ui/` (@gudbro/ui) — component exports, usage across apps
- `shared/components/` (@gudbro/components) — ProductCard variants, app usage
- `shared/config/` (@gudbro/config) — env validation, constants
- `shared/types/` (@gudbro/types) — Supabase generated types, custom types
- `shared/utils/` (@gudbro/utils) — AppError, logger, Result type, API helpers
- `shared/database/` (@gudbro/database) — migrations, seed data, types
- `shared/payment/` (@shared/payment) — PaymentMethod types, formatPrice, convertCurrency
- `shared/core/` — TranslationEngine, module types, template configs (check if workspace package)
- `shared/menu-template/` (@gudbro/menu-template) — Header, Footer, BottomNav, VerticalConfig
- `shared/seo/` — meta-tags, schema-org, robots, sitemap (check if workspace package)

For each package, record: name, location, package name, key exports, which apps import it, estimated LOC, and status (ready/needs-adaptation/to-build for accommodations use).

**Step 2: Identify duplicated patterns across apps**

Grep for these known duplicated files across `apps/*/frontend/lib/`:

- `currency-converter.ts` — check divergence between coffeeshop (most complete) and other apps
- `currency-preferences.ts` — check divergence level
- `usePriceFormat.ts` or similar price formatting hooks
- `lib/seo/` directories — check if identical or diverged from shared/seo
- `supabase.ts` client setup patterns — compare approaches across apps
- Vertical config patterns (verticalConfig objects)

For each duplicated pattern, record: which apps have copies, divergence level (HIGH/MEDIUM/LOW), LOC range across copies, and recommendation.

**Step 3: Catalog extractable backoffice modules**

Scan `apps/backoffice/lib/` for modules with cross-vertical reuse potential:

- `lib/qr/` — QR generation (needed by Phase 31, 33)
- `lib/ai/feedback-intelligence-service.ts` — AI feedback pipeline (Phase 35)
- `lib/ai/conventions-service.ts` — Conventions (Phase 37)
- `lib/notifications/` — Notification dispatch (Phases 31, 34, 35, 38)
- `lib/auth/` — Auth system
- `lib/tenancy/` — Multi-tenant context
- `lib/i18n/` — Internationalization (Phase 36)
- `lib/security/rate-limiter.ts` — Rate limiting (Phase 31)

Also scan `apps/accommodations/frontend/lib/` for reusable utils:

- `image-utils.ts` — Image processing (Phases 31, 32)
- `wifi-utils.ts` — WiFi helpers (Phase 31)

For each module, record: location, key exports, current coupling (backoffice-specific vs generic), reuse potential (HIGH/MEDIUM/LOW), and which phases need it.

**Step 4: Write the catalog document**

Organize by functional area (NOT by directory):

1. **UI Components** — @gudbro/ui, @gudbro/components, @gudbro/menu-template
2. **Data & Types** — @gudbro/types, @gudbro/config
3. **Infrastructure** — @gudbro/utils, @gudbro/database, supabase client patterns
4. **Business Logic** — @shared/payment, currency conversion, price formatting
5. **Content & i18n** — @gudbro/core (TranslationEngine), i18n system, SEO
6. **Backoffice Extractables** — QR, AI pipeline, notifications, rate limiter, auth
7. **Accommodations-Specific** — image utils, WiFi utils, document handling
8. **Duplicated Patterns** — patterns found in 2+ apps that should be consolidated

For each module entry include:

- **Name** and location (exact path)
- **Package name** (if workspace package) or "not packaged"
- **Status**: ready | needs adaptation | to-build
- **Key exports** (actual function/component names)
- **Used by** (which apps import it)
- **Import example** for "ready" modules: `import { X } from '@gudbro/ui'`
- **Adaptation needed** for "needs adaptation" entries: specific changes required for accommodations context
- **Phases that need it**: which of 31-39 depend on this module

Then add:

- **Phase Dependency Matrix** — table mapping each phase (31-39) to which shared modules it needs, with priority ranking (higher dependency count = higher priority for extraction)
- **Phase 31 Blockers** — flag any modules that Phase 31 specifically needs and their current readiness

The catalog must be actionable: a planner reading one module entry should be able to decide build-vs-reuse without further investigation.
</action>
<verify>
Verify the catalog is complete and well-structured:

1. `grep -c "^###" .planning/phases/30-shared-module-audit/SHARED-MODULE-CATALOG.md` returns 8+ section headers (one per functional area)
2. `grep -c "ready\|needs adaptation\|to-build" .planning/phases/30-shared-module-audit/SHARED-MODULE-CATALOG.md` returns 15+ status classifications
3. `grep "Phase Dependency Matrix" .planning/phases/30-shared-module-audit/SHARED-MODULE-CATALOG.md` finds the matrix section
4. `grep "Phase 31" .planning/phases/30-shared-module-audit/SHARED-MODULE-CATALOG.md` finds Phase 31 blocker analysis
5. `grep "import" .planning/phases/30-shared-module-audit/SHARED-MODULE-CATALOG.md` finds import path examples for "ready" modules
   </verify>
   <done>
   A single SHARED-MODULE-CATALOG.md exists containing:

- Every shared workspace package with status classification and import examples
- Every duplicated pattern across verticals with divergence assessment and consolidation recommendation
- Every extractable backoffice module with reuse potential and coupling analysis
- Specific adaptation notes for every "needs adaptation" entry
- Phase Dependency Matrix mapping phases 31-39 to required modules with priority ranking
- Phase 31 blockers clearly flagged
  </done>
  </task>

</tasks>

<verification>
1. `.planning/phases/30-shared-module-audit/SHARED-MODULE-CATALOG.md` exists and is non-empty
2. Document covers all 8 functional areas with module entries
3. Every module has a status classification (ready / needs adaptation / to-build)
4. "Needs adaptation" entries have specific change descriptions (not vague)
5. Phase Dependency Matrix is present with all phases 31-39 mapped
6. Import path examples are present for all "ready" modules
7. Phase 31 blocker modules are identified
</verification>

<success_criteria>

- Catalog document is complete, organized by functional area, and covers all shared modules
- A planner for Phase 31 can open this catalog and immediately know which modules to reuse vs build
- A planner for any phase 31-39 can reference a single module entry and decide build-vs-reuse without further codebase investigation
- No code changes were made — this is a pure informational artifact
  </success_criteria>

<output>
After completion, create `.planning/phases/30-shared-module-audit/30-01-SUMMARY.md`
</output>
