---
phase: 06-in-stay-dashboard
plan: 03
type: execute
wave: 2
depends_on: ['06-01', '06-02']
files_modified:
  - apps/accommodations/frontend/app/stay/[code]/page.tsx
  - apps/accommodations/frontend/components/stay/DashboardHeader.tsx
  - apps/accommodations/frontend/components/stay/WifiCard.tsx
  - apps/accommodations/frontend/components/stay/WelcomeCard.tsx
  - apps/accommodations/frontend/components/stay/QuickActions.tsx
  - apps/accommodations/frontend/components/stay/CheckoutInfo.tsx
  - apps/accommodations/frontend/components/stay/ContactSheet.tsx
  - apps/accommodations/frontend/components/stay/VisaStatusCard.tsx
  - apps/accommodations/frontend/components/stay/ReturnGuestBanner.tsx
autonomous: true

must_haves:
  truths:
    - 'Dashboard page is a shell that delegates to section components (no 1387-line monolith)'
    - 'WiFi card displays network name and password from real stay data with copy-to-clipboard'
    - 'Welcome card shows guest name, room number, dates, and checkout countdown from real booking data'
    - 'Quick actions open WhatsApp with pre-filled messages using real property contact number'
    - 'Checkout info shows time and procedure from real property data'
    - 'Contact host opens WhatsApp with pre-filled message'
    - 'Dashboard redirects to / if no valid session'
    - 'Loading states shown while data loads (no flash of wrong content)'
  artifacts:
    - path: 'apps/accommodations/frontend/app/stay/[code]/page.tsx'
      provides: 'Dashboard shell page with session check and component composition'
      min_lines: 30
    - path: 'apps/accommodations/frontend/components/stay/WifiCard.tsx'
      provides: 'WiFi card with copy-to-clipboard'
      contains: 'navigator.clipboard'
    - path: 'apps/accommodations/frontend/components/stay/WelcomeCard.tsx'
      provides: 'Stay summary with countdown'
      contains: 'differenceInCalendarDays'
    - path: 'apps/accommodations/frontend/components/stay/QuickActions.tsx'
      provides: 'WhatsApp quick action buttons'
      contains: 'wa.me'
    - path: 'apps/accommodations/frontend/components/stay/ContactSheet.tsx'
      provides: 'Host contact options'
      contains: 'wa.me'
  key_links:
    - from: 'apps/accommodations/frontend/app/stay/[code]/page.tsx'
      to: 'hooks/useStaySession.ts'
      via: 'useStaySession hook'
      pattern: 'useStaySession'
    - from: 'apps/accommodations/frontend/app/stay/[code]/page.tsx'
      to: 'lib/stay-api.ts'
      via: 'fetchProperty'
      pattern: 'fetchProperty'
    - from: 'apps/accommodations/frontend/components/stay/WifiCard.tsx'
      to: 'stay.wifi data from verify response'
      via: 'props from parent'
      pattern: 'wifi'
---

<objective>
Split the monolithic 1387-line dashboard page into composable section components and wire the core sections to real API data. This plan handles: dashboard shell, WiFi card, welcome/stay summary, quick actions, checkout info, contact host, visa status card, and return guest banner.

Purpose: The monolith cannot be wired to real data without splitting first. This plan extracts sections into components that receive real data from the verify response (for initial data) and fetchProperty (for extended property info). Sections that need their own API calls (services, deals, useful numbers) are handled in Plan 04.
Output: Rewritten dashboard page as thin shell + 8 section components wired to real data.
</objective>

<execution_context>
@/Users/gianfrancodagostino/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gianfrancodagostino/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-in-stay-dashboard/06-RESEARCH.md
@.planning/phases/06-in-stay-dashboard/06-CONTEXT.md

Key source files to reference for current mock UI/layout:
@apps/accommodations/frontend/app/stay/[code]/page.tsx
@apps/accommodations/frontend/types/stay.ts
@apps/accommodations/frontend/components/BottomNav.tsx

Plan 02 outputs (session + API layer):

- hooks/useStaySession.ts (provides token, stay, isAuthenticated, isLoading)
- lib/stay-api.ts (provides fetchProperty, fetchServices, fetchDeals, fetchUsefulNumbers)
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Dashboard shell and core data components (WiFi, Welcome, QuickActions, Checkout, Contact)</name>
  <files>
    apps/accommodations/frontend/app/stay/[code]/page.tsx
    apps/accommodations/frontend/components/stay/DashboardHeader.tsx
    apps/accommodations/frontend/components/stay/WifiCard.tsx
    apps/accommodations/frontend/components/stay/WelcomeCard.tsx
    apps/accommodations/frontend/components/stay/QuickActions.tsx
    apps/accommodations/frontend/components/stay/CheckoutInfo.tsx
    apps/accommodations/frontend/components/stay/ContactSheet.tsx
  </files>
  <action>
IMPORTANT: Read the current monolithic page.tsx FIRST to understand the existing mock UI layout, styling, and sections. Preserve the visual design language (colors, spacing, card styles, icons) while replacing mock data with real data.

1. Rewrite app/stay/[code]/page.tsx as a thin dashboard shell:
   - 'use client' directive
   - Extract booking code from route params
   - Use useStaySession hook — if not authenticated and not loading, redirect to /
   - Use fetchProperty(code, token) to load extended property data (checkout time, house rules, etc.)
   - Compose section components in order: DashboardHeader, WifiCard, WelcomeCard, VisaStatusCard (placeholder), QuickActions, ServicesCarousel (placeholder div), LocalDeals (placeholder div), UsefulNumbers (placeholder div), ReturnGuestBanner, CheckoutInfo, ContactSheet
   - Pass real data from stay (verify response) and property (fetchProperty response) as props
   - Show loading skeleton while property data loads
   - The page should be under 150 lines (shell only, no section logic)
   - Placeholder sections for Services, Deals, UsefulNumbers: render a simple loading div or comment — Plan 04 will create those components

2. Create components/stay/DashboardHeader.tsx:
   - Property name, optional image
   - Language selector placeholder (English only for now)
   - Use property data from props

3. Create components/stay/WifiCard.tsx:
   - Display WiFi network name and password from stay.wifi data
   - Copy-to-clipboard button using navigator.clipboard.writeText()
   - Show "Copied!" feedback for 2 seconds after copy
   - Card styling matching the existing mock card design
   - Props: { wifi: { network: string, password: string } }

4. Create components/stay/WelcomeCard.tsx:
   - Guest name greeting ("Welcome, John!")
   - Room number display
   - Check-in and check-out dates (formatted with date-fns format)
   - Days remaining countdown using date-fns differenceInCalendarDays(checkOut, today)
   - Guest count
   - Props: { booking: BookingInfo } (from stay data)

5. Create components/stay/QuickActions.tsx:
   - Grid of action buttons (Room Service, Concierge, Housekeeping, Report Issue)
   - Each action opens WhatsApp: https://wa.me/{PHONE}?text={ENCODED_MESSAGE}
   - Message includes room number and property name: "Room Service request - Room 301, Roots Da Nang"
   - Phone number from property contact (host_phone or contact_whatsapp)
   - If property has quick_actions in data, use those. Otherwise use default 4 actions.
   - Each button has Phosphor icon (ForkKnife, Compass, Broom, Warning)
   - Props: { actions: QuickAction[], phone: string, roomNumber: string, propertyName: string }

6. Create components/stay/CheckoutInfo.tsx:
   - Checkout time display (from property data)
   - Checkout procedure / key return instructions
   - Props: { checkoutTime: string, checkoutProcedure?: string }

7. Create components/stay/ContactSheet.tsx:
   - WhatsApp button: https://wa.me/{PHONE}?text={PRE_FILLED_MSG}
   - Phone call button: tel:{PHONE}
   - Pre-filled message: "Hi, I'm staying in Room {NUMBER} at {PROPERTY}. "
   - Can be a bottom sheet or a card section
   - Props: { phone: string, whatsapp?: string, roomNumber: string, propertyName: string }

All components use Tailwind for styling. Match the visual design from the existing mock page (read it first). Use Phosphor Icons where the mock uses icons. Ensure all text content comes from props (no hardcoded mock data).
</action>
<verify>
Run `cd /Users/gianfrancodagostino/Desktop/gudbro-verticals && pnpm --filter accommodations-frontend build` and confirm:

- Build passes with no TypeScript errors
- Dashboard page is under 200 lines
- No mock data remains in the dashboard shell or core components
  </verify>
  <done>Dashboard page is a thin shell composing 7 section components. WiFi card shows real network/password with copy. Welcome card shows real guest name, room, dates, countdown. Quick actions open WhatsApp with real phone and room. Checkout and contact use real property data. All mock data replaced with props from API responses.</done>
  </task>

<task type="auto">
  <name>Task 2: Visa status card and return guest banner components</name>
  <files>
    apps/accommodations/frontend/components/stay/VisaStatusCard.tsx
    apps/accommodations/frontend/components/stay/ReturnGuestBanner.tsx
  </files>
  <action>
1. Create components/stay/VisaStatusCard.tsx:
   - For MVP: display general visa information for the property's country
   - Since guest_country is now in the DB but visa rules are static reference data (per RESEARCH.md), use a simple approach:
     - If guest_country is available, show: "Vietnam offers visa exemption for [X] days for [country] citizens"
     - Use a small hardcoded lookup of common visa exemptions for Vietnam (US: 45 days, UK: 45 days, EU: 45 days, JP: 45 days, KR: 45 days, AU: 45 days)
     - If guest_country not in lookup or not available, show general text: "Check visa requirements for your nationality at vietnam-visa.com"
   - Show days remaining on visa (if known: entry_date + visa_days - today)
   - Card can be hidden entirely if no guest_country available (conditional render in parent)
   - Props: { guestCountry?: string, checkInDate: string }

2. Create components/stay/ReturnGuestBanner.tsx:
   - Conditional component: only renders if return_banner_text is provided
   - Displays promotional text (e.g., "Loved your stay? Book again and get 10% off!")
   - CTA button that opens return_banner_url (WhatsApp link or booking URL)
   - Dismissible: user can close it, remember in localStorage
   - Props: { text: string, url: string }
   - If text is null/undefined, component returns null

Both components use Tailwind styling matching the existing dashboard card design.
</action>
<verify>
Run `cd /Users/gianfrancodagostino/Desktop/gudbro-verticals && pnpm --filter accommodations-frontend build` and confirm build passes.
</verify>
<done>Visa status card shows visa exemption info based on guest nationality. Return guest banner conditionally shows promo with CTA. Both compile and render conditionally based on available data.</done>
</task>

</tasks>

<verification>
- Dashboard page.tsx is under 200 lines (was 1387)
- All section components exist in components/stay/
- No hardcoded mock data in any component (all data from props)
- WiFi copy-to-clipboard works (navigator.clipboard.writeText)
- WhatsApp links use wa.me format with encoded messages
- Dashboard redirects to / if no valid session
- `pnpm --filter accommodations-frontend build` succeeds
</verification>

<success_criteria>

- Monolith split into shell + 9 components (Header, WiFi, Welcome, Visa, QuickActions, Checkout, Contact, ReturnBanner + placeholders for Services/Deals/UsefulNumbers)
- All core sections display real data from verify response and fetchProperty
- Loading states prevent flash of wrong content
- WhatsApp integration works with real phone numbers and pre-filled messages
- Copy-to-clipboard works for WiFi password
- Checkout countdown shows correct days remaining
  </success_criteria>

<output>
After completion, create `.planning/phases/06-in-stay-dashboard/06-03-SUMMARY.md`
</output>
