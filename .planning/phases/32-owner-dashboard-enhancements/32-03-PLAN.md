---
phase: 32-owner-dashboard-enhancements
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/backoffice/app/(dashboard)/accommodations/calendar/page.tsx
  - apps/backoffice/app/(dashboard)/accommodations/bookings/page.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - 'Owner sees Monthly/Timeline toggle on calendar page'
    - 'Timeline view renders GanttCalendar with rooms-by-dates grid'
    - 'Clicking a booking bar in Gantt navigates to booking detail'
    - 'Bookings page has a History tab showing checked_out bookings'
  artifacts:
    - path: 'apps/backoffice/app/(dashboard)/accommodations/calendar/page.tsx'
      provides: 'GanttCalendar integration with view toggle'
      contains: 'GanttCalendar'
    - path: 'apps/backoffice/app/(dashboard)/accommodations/bookings/page.tsx'
      provides: 'History tab in bookings'
      contains: 'history'
  key_links:
    - from: 'calendar/page.tsx'
      to: 'GanttCalendar.tsx'
      via: 'import + conditional render'
      pattern: 'import.*GanttCalendar'
    - from: 'bookings/page.tsx'
      to: 'history tab filter'
      via: 'TabKey type + filter logic'
      pattern: 'history'
---

<objective>
Wire GanttCalendar into the calendar page and add History tab to the bookings page.

Purpose: Close gaps 1, 2, 3 from verification — GanttCalendar and GanttBookingBar components exist but are orphaned (never imported by consuming pages). Bookings page lacks a History tab.
Output: Calendar page with Monthly/Timeline toggle; Bookings page with History tab.
</objective>

<execution_context>
@/Users/gianfrancodagostino/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gianfrancodagostino/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/32-owner-dashboard-enhancements/32-VERIFICATION.md

Key files (read these FIRST):
@apps/backoffice/app/(dashboard)/accommodations/calendar/page.tsx
@apps/backoffice/components/accommodations/GanttCalendar.tsx
@apps/backoffice/components/accommodations/GanttBookingBar.tsx
@apps/backoffice/app/(dashboard)/accommodations/bookings/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire GanttCalendar into calendar page with view toggle</name>
  <files>apps/backoffice/app/(dashboard)/accommodations/calendar/page.tsx</files>
  <action>
    Modify the existing calendar page to integrate the already-built GanttCalendar component:

    1. Add import: `import GanttCalendar from '@/components/accommodations/GanttCalendar';`
    2. Add view state: `const [calendarView, setCalendarView] = useState<'monthly' | 'timeline'>('monthly');`
    3. Add toggle buttons in the page header area (near the existing calendar title/controls):
       - Two buttons: "Monthly" and "Timeline"
       - Style: use the same button pattern as other toggles in the backoffice (e.g., Tailwind classes for active/inactive states)
       - Active button should be visually distinct (e.g., bg-blue-600 text-white vs bg-gray-100 text-gray-700)
    4. Conditional render: When calendarView === 'timeline', render `<GanttCalendar propertyId={PROPERTY_ID} />` instead of the existing AvailabilityCalendar section.
       When calendarView === 'monthly', render the existing AvailabilityCalendar (current behavior, unchanged).
    5. The GanttCalendar component already handles its own data fetching (bookings with dateFrom/dateTo), room loading, date navigation, and mobile detection. Do NOT duplicate any of that logic in the page.
    6. If GanttCalendar expects an `onDateRangeChange` callback prop, provide a no-op or simple handler. Read the component's props interface to confirm what's required.

    IMPORTANT: Do NOT modify GanttCalendar.tsx or GanttBookingBar.tsx — they are already complete and well-built. Only modify the calendar page.

  </action>
  <verify>
    - `grep -n "GanttCalendar" apps/backoffice/app/\(dashboard\)/accommodations/calendar/page.tsx` shows import and usage
    - `grep -n "timeline" apps/backoffice/app/\(dashboard\)/accommodations/calendar/page.tsx` shows view toggle logic
    - `pnpm --filter backoffice exec tsc --noEmit` passes (or at minimum, no NEW type errors in calendar/page.tsx)
  </verify>
  <done>Calendar page imports GanttCalendar, shows Monthly/Timeline toggle, and conditionally renders the Gantt view when Timeline is selected. Monthly view remains unchanged.</done>
</task>

<task type="auto">
  <name>Task 2: Add History tab to bookings page</name>
  <files>apps/backoffice/app/(dashboard)/accommodations/bookings/page.tsx</files>
  <action>
    Modify the existing bookings page to add a History tab:

    1. Find the TabKey type (likely a union type like `'all' | 'pending' | 'confirmed' | 'checked_in' | 'cancelled'`). Add `'history'` to it.
    2. Find the tabs configuration array. Add a new tab entry: `{ key: 'history', label: 'History' }` — place it as the last tab.
    3. Add a history filter in the filtering logic. History should show bookings where `status === 'checked_out'`. Include cancelled bookings too if they make sense for history context: `b.status === 'checked_out' || (b.status === 'cancelled' && past checkout date)`. Read the existing filter patterns to match style.
    4. Add history count to the counts object used for tab badges (if tab badges exist).
    5. The History tab should reuse the exact same booking list rendering as other tabs — no new components needed. The existing BookingStatusBadge already handles 'checked_out' status display.

    IMPORTANT: Preserve all existing tab functionality. Only ADD the new history tab.

  </action>
  <verify>
    - `grep -n "history" apps/backoffice/app/\(dashboard\)/accommodations/bookings/page.tsx` shows tab key, filter, and tab config
    - `pnpm --filter backoffice exec tsc --noEmit` passes (or no NEW type errors in bookings/page.tsx)
  </verify>
  <done>Bookings page has a "History" tab that filters to checked_out (and optionally cancelled) bookings. All existing tabs work unchanged.</done>
</task>

</tasks>

<verification>
- Calendar page: Importing GanttCalendar, view toggle state exists, conditional rendering works
- Bookings page: History tab visible, filters correctly, counts displayed
- No regressions: Monthly calendar view still works, all existing booking tabs still work
- TypeScript: No new type errors introduced
</verification>

<success_criteria>

- GanttCalendar is reachable from the UI (calendar page Timeline toggle)
- GanttBookingBar click-to-detail is reachable (rendered inside GanttCalendar)
- Bookings page shows History tab with past bookings
- Zero modifications to GanttCalendar.tsx, GanttBookingBar.tsx, or any other existing component
  </success_criteria>

<output>
After completion, create `.planning/phases/32-owner-dashboard-enhancements/32-03-SUMMARY.md`
</output>
