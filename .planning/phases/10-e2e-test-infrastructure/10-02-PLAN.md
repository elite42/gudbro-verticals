---
phase: 10-e2e-test-infrastructure
plan: 02
type: execute
wave: 2
depends_on: ['10-01']
files_modified:
  - playwright.config.ts
  - tests/e2e/verticals/wellness.smoke.spec.ts
autonomous: true

must_haves:
  truths:
    - 'playwright.config.ts defines per-vertical projects (mobile + desktop) for all 8 verticals using testMatch that isolates from legacy tests'
    - 'Running --project=wellness-mobile executes only vertical smoke tests against localhost:3003'
    - "At least one vertical's smoke test passes end-to-end using the shared fixtures"
    - 'Existing 35 F&B/waiter/backoffice tests still pass without modification when run with their original projects'
  artifacts:
    - path: 'playwright.config.ts'
      provides: 'Per-vertical projects (16 total: 8 mobile + 8 desktop) plus existing 6 legacy projects'
      contains: 'verticalProjects'
    - path: 'tests/e2e/verticals/wellness.smoke.spec.ts'
      provides: 'Validation smoke test for wellness vertical'
      contains: 'Wellness PWA Smoke'
  key_links:
    - from: 'playwright.config.ts'
      to: 'tests/e2e/shared/vertical-registry.ts'
      via: 'import VERTICALS'
      pattern: 'import.*VERTICALS.*from.*vertical-registry'
    - from: 'tests/e2e/verticals/wellness.smoke.spec.ts'
      to: 'tests/e2e/shared/fixtures.ts'
      via: 'import test, expect'
      pattern: 'import.*test.*expect.*from.*shared/fixtures'
    - from: 'tests/e2e/verticals/wellness.smoke.spec.ts'
      to: 'tests/e2e/shared/vertical-registry.ts'
      via: 'import VERTICALS'
      pattern: 'import.*VERTICALS.*from.*vertical-registry'
---

<objective>
Extend playwright.config.ts with per-vertical projects and create a wellness smoke test to validate the pattern works end-to-end.

Purpose: This plan wires the shared fixtures (from Plan 01) into the Playwright config and proves the entire pattern works by running at least one vertical's smoke test. After this plan, any developer can run `SKIP_WEBSERVER=1 npx playwright test --project=wellness-mobile` to smoke-test the wellness PWA.

Output: Updated `playwright.config.ts` with 16 new vertical projects (8 verticals x 2 viewports) + 1 validation smoke test file.
</objective>

<execution_context>
@/Users/gianfrancodagostino/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gianfrancodagostino/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-e2e-test-infrastructure/10-RESEARCH.md
@.planning/phases/10-e2e-test-infrastructure/10-01-SUMMARY.md
@playwright.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add vertical projects to playwright.config.ts</name>
  <files>playwright.config.ts</files>
  <action>
Update `playwright.config.ts` to add per-vertical projects. Keep ALL existing config untouched (projects, webServer, reporter, use, etc.).

Changes:

1. Add import at the top: `import { VERTICALS } from './tests/e2e/shared/vertical-registry';`
2. Add import: `import { VIEWPORTS } from './tests/e2e/shared/viewport-helpers';`
3. Before the `export default defineConfig()` call, generate vertical projects:

```typescript
const verticalProjects = Object.entries(VERTICALS).flatMap(([slug, config]) => [
  {
    name: `${slug}-mobile`,
    testMatch: /verticals\/.*\.smoke\.spec\.ts/,
    use: {
      ...VIEWPORTS.mobile,
      baseURL: config.baseURL,
      verticalConfig: config,
    },
  },
  {
    name: `${slug}-desktop`,
    testMatch: /verticals\/.*\.smoke\.spec\.ts/,
    use: {
      ...VIEWPORTS.desktop,
      baseURL: config.baseURL,
      verticalConfig: config,
    },
  },
]);
```

4. In the `projects` array, spread `...verticalProjects` AFTER the existing 6 projects (chromium, Mobile Chrome, Mobile Safari, multi-system, waiter-pwa, backoffice).

CRITICAL constraints:

- Do NOT modify any existing project entry
- Do NOT modify the webServer section
- Do NOT remove or change the SYSTEM_URLS export
- The `testMatch: /verticals\/.*\.smoke\.spec\.ts/` pattern ensures vertical projects ONLY pick up files in `tests/e2e/verticals/` ending with `.smoke.spec.ts` -- no overlap with existing tests in `scenarios/`, `waiter/`, or `backoffice/`
- The `verticalConfig` key in `use` passes the config as a fixture option to the extended test object from Plan 01's `fixtures.ts`
  </action>
  <verify>

1. Run: `npx tsc --noEmit playwright.config.ts` to confirm config compiles
2. Run: `SKIP_WEBSERVER=1 npx playwright test --list --project=wellness-mobile 2>&1 | head -20` to confirm the project is recognized
3. Run: `SKIP_WEBSERVER=1 npx playwright test --list --project=chromium 2>&1 | head -20` to confirm existing project still lists its tests (no overlap with vertical testMatch)
   </verify>
   <done>
   `playwright.config.ts` has 22 projects total (6 existing + 16 vertical). Running `--project=wellness-mobile` lists only vertical smoke test files. Running `--project=chromium` still lists only legacy test files.
   </done>
   </task>

<task type="auto">
  <name>Task 2: Create wellness validation smoke test</name>
  <files>tests/e2e/verticals/wellness.smoke.spec.ts</files>
  <action>
Create `tests/e2e/verticals/` directory.

Create `tests/e2e/verticals/wellness.smoke.spec.ts` following the pattern from the research:

```typescript
import { test, expect } from '../shared/fixtures';
import { VERTICALS } from '../shared/vertical-registry';

const vertical = VERTICALS.wellness;

test.describe(`${vertical.name} PWA Smoke`, () => {
  test('home page loads successfully', async ({ pwaPage }) => {
    await pwaPage.expectPageLoads();
  });

  test('page has title', async ({ pwaPage }) => {
    await pwaPage.goto();
    await pwaPage.expectTitle();
  });

  test('navigation is visible', async ({ pwaPage }) => {
    await pwaPage.goto();
    await pwaPage.expectNavigationVisible();
  });

  test('no console errors on home', async ({ pwaPage }) => {
    await pwaPage.expectNoConsoleErrors();
  });

  test('key routes are accessible', async ({ page }) => {
    for (const [name, path] of Object.entries(vertical.routes)) {
      const response = await page.goto(path);
      expect(
        response?.status(),
        `Route ${name} (${path}) should return 200`
      ).toBe(200);
    }
  });
});
```

This file:

- Imports `test` and `expect` from shared fixtures (NOT from @playwright/test directly)
- Uses `VERTICALS.wellness` config
- Has 5 smoke tests covering: page load, title, navigation, console errors, route accessibility
- Uses `pwaPage` fixture for BasePwaPage methods
- Uses raw `page` for route iteration (inherited from Playwright base)

Note: The `pwaPage` fixture receives its `verticalConfig` from the project's `use.verticalConfig` option set in `playwright.config.ts` Task 1. Each project provides the correct vertical config, so the smoke spec file itself doesn't need to wire the config -- it comes from the project.

IMPORTANT: Review the fixtures.ts from Plan 01. If `verticalConfig` is an option fixture that throws by default, the project `use.verticalConfig` will override it. This is the Playwright option pattern. If this doesn't work at runtime, adjust fixtures.ts to derive config from `testInfo.project.name` instead.
</action>
<verify>

1. Start the wellness dev server: `pnpm dev:wellness` (or equivalent -- check package.json for exact command)
2. Run: `SKIP_WEBSERVER=1 npx playwright test --project=wellness-mobile tests/e2e/verticals/wellness.smoke.spec.ts`
3. All 5 tests should pass
4. Run: `SKIP_WEBSERVER=1 npx playwright test --project=wellness-desktop tests/e2e/verticals/wellness.smoke.spec.ts`
5. All 5 tests should pass on desktop too
6. Verify existing tests not broken: `npx playwright test --list --project=chromium` should still list the same legacy tests (no vertical smoke tests in the list)
   </verify>
   <done>
   `wellness.smoke.spec.ts` exists with 5 smoke tests. At least the mobile or desktop project passes all 5 tests against a running wellness dev server. Existing legacy test listing is unchanged.
   </done>
   </task>

</tasks>

<verification>
1. `playwright.config.ts` compiles without TypeScript errors
2. `npx playwright test --list` shows all 22 projects (6 legacy + 16 vertical)
3. `--project=wellness-mobile` runs ONLY vertical smoke tests, not legacy tests
4. `--project=chromium` runs ONLY legacy tests, not vertical smoke tests
5. Wellness smoke test passes against running dev server (5/5 tests)
6. No existing test files were modified (diff shows only new files + playwright.config.ts changes)
</verification>

<success_criteria>

- playwright.config.ts has 22 projects (6 existing + 16 vertical)
- testMatch isolation: vertical projects match only `verticals/*.smoke.spec.ts`
- wellness.smoke.spec.ts passes with at least one project (mobile or desktop)
- Existing tests remain functional (no file modifications, same test listing)
  </success_criteria>

<output>
After completion, create `.planning/phases/10-e2e-test-infrastructure/10-02-SUMMARY.md`
</output>
