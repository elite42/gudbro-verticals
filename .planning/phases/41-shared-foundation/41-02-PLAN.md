---
phase: 41-shared-foundation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - shared/config/tsconfig.app.json
  - shared/config/tailwind.preset.js
  - shared/config/next.config.base.js
autonomous: true

must_haves:
  truths:
    - "shared/config/ contains a base tsconfig that PWA apps can extend with a single 'extends' line"
    - 'shared/config/ contains a Tailwind preset with shared color tokens, animations, and keyframes'
    - 'shared/config/ contains a Next.js config factory that accepts { port } and returns a complete config'
    - 'All three config files are usable without modification to existing app behavior'
  artifacts:
    - path: 'shared/config/tsconfig.app.json'
      provides: 'Base TypeScript config for all PWA frontends'
      contains: 'compilerOptions'
    - path: 'shared/config/tailwind.preset.js'
      provides: 'Shared Tailwind design tokens preset'
      contains: 'theme'
    - path: 'shared/config/next.config.base.js'
      provides: 'Next.js config factory function'
      contains: 'createNextConfig'
  key_links:
    - from: 'shared/config/tsconfig.app.json'
      to: 'tsconfig.base.json'
      via: 'extends'
      pattern: 'extends.*tsconfig.base'
    - from: 'shared/config/next.config.base.js'
      to: 'per-app next.config.js'
      via: 'createNextConfig factory'
      pattern: 'createNextConfig'
---

<objective>
Create shared configuration files (tsconfig, Tailwind preset, Next.js config factory) in shared/config/.

Purpose: Standardize configuration across all 8+ PWAs. Currently each app has its own tsconfig, tailwind.config, and next.config with duplicated settings. Only coffeeshop extends the root tsconfig.base.json. This plan creates the base configs that Plan 03 will migrate all apps to use.

Output: Three new files in shared/config/ -- tsconfig.app.json, tailwind.preset.js, next.config.base.js
</objective>

<execution_context>
@/Users/gianfrancodagostino/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gianfrancodagostino/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/41-shared-foundation/41-RESEARCH.md

# Reference configs (read these to understand current patterns):

@tsconfig.base.json
@apps/coffeeshop/frontend/tsconfig.json
@apps/gym/frontend/tsconfig.json
@apps/coffeeshop/frontend/tailwind.config.ts
@apps/gym/frontend/tailwind.config.ts
@apps/coffeeshop/frontend/next.config.js
@apps/gym/frontend/next.config.js
@apps/laundry/frontend/next.config.js

# Existing shared config package:

@shared/config/package.json
@shared/config/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create base tsconfig.app.json for PWA apps</name>
  <files>shared/config/tsconfig.app.json</files>
  <action>
    Create `shared/config/tsconfig.app.json` that extends the root tsconfig.base.json. This is the base TypeScript config for all PWA frontend apps.

    Key settings (derived from coffeeshop's tsconfig which is the most complete):
    - `"extends": "../../tsconfig.base.json"` (shared/config/ is 2 levels from root)
    - compilerOptions:
      - `"target": "ES2017"` (matching coffeeshop)
      - `"lib": ["dom", "dom.iterable", "esnext"]`
      - `"allowJs": true`
      - `"skipLibCheck": true`
      - `"strict": true` (coffeeshop has this, others may not -- standardize to strict)
      - `"noEmit": true`
      - `"esModuleInterop": true`
      - `"module": "esnext"`
      - `"moduleResolution": "bundler"` (matching coffeeshop)
      - `"resolveJsonModule": true`
      - `"isolatedModules": true`
      - `"jsx": "preserve"`
      - `"incremental": true`
      - `"plugins": [{ "name": "next" }]`
      - `"paths"` section with @gudbro/* aliases:
        ```
        "@/*": ["./*"],
        "@gudbro/types": ["../../shared/types"],
        "@gudbro/config": ["../../shared/config"],
        "@gudbro/utils": ["../../shared/utils"],
        "@gudbro/ui": ["../../shared/ui"],
        "@gudbro/hooks": ["../../shared/hooks"]
        ```
    - `"include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"]`
    - `"exclude": ["node_modules"]`

    NOTE: The paths use `../../shared/*` which is correct for apps at `apps/X/frontend/` (3 levels deep). Apps at `apps/X/` (2 levels, like backoffice/waiter) will need to override paths in their local tsconfig. Document this in a comment at the top of the file.

    Do NOT modify the existing shared/config/index.ts or package.json -- this is a standalone JSON config file, not a TypeScript module export.

  </action>
  <verify>
    Run `cat shared/config/tsconfig.app.json | python3 -c "import sys,json; json.load(sys.stdin); print('Valid JSON')"` -- must output "Valid JSON".
    Verify it extends base: `grep "extends" shared/config/tsconfig.app.json` should show tsconfig.base.json reference.
  </verify>
  <done>
    shared/config/tsconfig.app.json exists with strict TypeScript settings, Next.js plugin, and @gudbro/* path aliases pointing to all shared packages including @gudbro/hooks.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Tailwind preset and Next.js config factory</name>
  <files>
    shared/config/tailwind.preset.js
    shared/config/next.config.base.js
  </files>
  <action>
    **tailwind.preset.js:**
    Create a Tailwind CSS preset with shared design tokens. Based on coffeeshop's tailwind.config (most extensive).

    Key content:
    - Export a Tailwind config object (CommonJS `module.exports`) usable via `presets: [require('path/to/preset')]`
    - `theme.extend.colors` with CSS variable-based semantic tokens:
      - `theme.bg.*` (primary, secondary, tertiary, elevated) using `var(--color-bg-*)` pattern
      - `theme.text.*` (primary, secondary, tertiary, inverse) using `var(--color-text-*)`
      - `theme.border.*` (light, medium, heavy) using `var(--color-border-*)`
      - `theme.interactive.*` (primary, primary-hover, secondary, secondary-hover, danger, success, warning)
    - `theme.extend.animation` with shared animations: bounce-once, slide-up, fade-in, scale-in
    - `theme.extend.keyframes` for slide-up, fade-in, scale-in (from research code examples)
    - Do NOT include `content` paths -- those stay in each app's tailwind.config (content paths are relative to the app, not the preset)
    - Do NOT include app-specific colors (each app defines its own primary/accent via CSS variables)

    **next.config.base.js:**
    Create a factory function for Next.js configuration. Based on analysis of 11 next.config.js files across apps.

    Key content:
    - CommonJS export: `module.exports = { createNextConfig }`
    - `createNextConfig({ port, additionalDomains = [], overrides = {} })` function
    - Base config includes:
      - `reactStrictMode: true`
      - `images.domains`: common domains used across apps (images.unsplash.com, cdn.gudbro.com, img.vietqr.io, flagcdn.com, api.qrserver.com)
      - `images.formats`: ['image/avif', 'image/webp']
      - `images.deviceSizes` and `images.imageSizes` matching coffeeshop's config
      - `env.NEXT_PUBLIC_API_URL`: `process.env.NEXT_PUBLIC_API_URL || 'http://localhost:${port}'`
    - Deep merge overrides into base (use simple spread for top-level, manual merge for images.domains to append additionalDomains)
    - Per-app usage will be: `const { createNextConfig } = require('../../shared/config/next.config.base'); module.exports = createNextConfig({ port: 3033 });`

  </action>
  <verify>
    Run `node -e "const p = require('./shared/config/tailwind.preset.js'); console.log(Object.keys(p.theme.extend))"` -- should output colors, animation, keyframes.
    Run `node -e "const { createNextConfig } = require('./shared/config/next.config.base.js'); const c = createNextConfig({ port: 3033 }); console.log(c.images.domains.length > 0, c.env.NEXT_PUBLIC_API_URL)"` -- should output true and the localhost URL.
  </verify>
  <done>
    tailwind.preset.js exports a valid Tailwind preset with semantic color tokens and shared animations. next.config.base.js exports createNextConfig factory that produces a complete Next.js config when given a port number. Both files use CommonJS (required for config files).
  </done>
</task>

</tasks>

<verification>
1. `shared/config/tsconfig.app.json` is valid JSON and extends tsconfig.base.json
2. `shared/config/tailwind.preset.js` is a valid CommonJS module with theme.extend.colors
3. `shared/config/next.config.base.js` exports createNextConfig and returns valid config
4. No existing files in shared/config/ are broken (index.ts, constants.ts, env.ts unchanged)
5. No build regressions: `pnpm --filter @gudbro/config build` still passes
</verification>

<success_criteria>

- Three new config files exist in shared/config/
- tsconfig.app.json has strict mode, Next.js plugin, and all @gudbro/\* path aliases
- tailwind.preset.js has semantic color tokens via CSS variables and shared animations
- next.config.base.js factory produces correct config with customizable port and domains
- Existing @gudbro/config package is not broken
  </success_criteria>

<output>
After completion, create `.planning/phases/41-shared-foundation/41-02-SUMMARY.md`
</output>
