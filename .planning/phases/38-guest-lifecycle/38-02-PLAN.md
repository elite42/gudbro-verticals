---
phase: 38-guest-lifecycle
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/accommodations/frontend/lib/delivery-apps-data.ts
  - apps/accommodations/frontend/components/stay/DeliveryAppsSection.tsx
  - apps/accommodations/frontend/app/stay/[code]/page.tsx
autonomous: true

must_haves:
  truths:
    - 'Guest dashboard shows delivery apps section with branded cards for country-appropriate food delivery apps'
    - 'Each delivery app card has app name, description, open-app button (universal link), and copy-address button'
    - 'Delivery apps are country-specific (Vietnam: Grab, ShopeeFood, Baemin; Thailand: Grab, Foodpanda, LINE MAN)'
    - 'Property address is displayed as copyable text for guest to paste into delivery app'
  artifacts:
    - path: 'apps/accommodations/frontend/lib/delivery-apps-data.ts'
      provides: 'Country-keyed delivery app configuration with logos, links, descriptions'
      contains: 'deliveryApps|DeliveryApp'
    - path: 'apps/accommodations/frontend/components/stay/DeliveryAppsSection.tsx'
      provides: 'Delivery apps card grid with open-app and copy-address buttons'
      contains: 'DeliveryAppsSection'
    - path: 'apps/accommodations/frontend/app/stay/[code]/page.tsx'
      provides: 'Stay page renders DeliveryAppsSection'
      contains: 'DeliveryAppsSection'
  key_links:
    - from: 'apps/accommodations/frontend/components/stay/DeliveryAppsSection.tsx'
      to: 'apps/accommodations/frontend/lib/delivery-apps-data.ts'
      via: 'import getDeliveryApps(countryCode)'
      pattern: 'getDeliveryApps'
    - from: 'apps/accommodations/frontend/app/stay/[code]/page.tsx'
      to: 'DeliveryAppsSection'
      via: 'component render with property address and country'
      pattern: 'DeliveryAppsSection'
---

<objective>
Create a delivery apps section in the guest dashboard showing branded cards for local food delivery services (Grab, ShopeeFood, Baemin, etc.) with universal deep-links and property address copy functionality.

Purpose: Help guests order food delivery to their accommodation without GUDBRO acting as an intermediary ‚Äî pure link-out to established delivery platforms with address convenience.
Output: Static delivery app config, branded card component, integration into stay page.
</objective>

<execution_context>
@/Users/gianfrancodagostino/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gianfrancodagostino/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/38-guest-lifecycle/38-RESEARCH.md

Key existing files:
@apps/accommodations/frontend/lib/concierge-data.ts (pattern to follow for country-keyed data)
@apps/accommodations/frontend/app/stay/[code]/page.tsx
@apps/accommodations/frontend/components/stay/ConciergeTransport.tsx (transport card pattern)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Delivery apps data config + DeliveryAppsSection component</name>
  <files>
    apps/accommodations/frontend/lib/delivery-apps-data.ts
    apps/accommodations/frontend/components/stay/DeliveryAppsSection.tsx
  </files>
  <action>
1. **Create delivery-apps-data.ts** following the concierge-data.ts country-keyed pattern:

```typescript
export interface DeliveryApp {
  id: string;
  name: string;
  description: string; // e.g., "Food, groceries & more"
  color: string; // Brand color for card accent
  iconEmoji: string; // Fallback emoji (üõµ, üçú, etc.)
  universalLink: string; // Web URL that opens app or falls back to web
  iosAppStore: string;
  googlePlay: string;
}

// Country-keyed registry
const deliveryAppsRegistry: Record<string, DeliveryApp[]> = {
  VN: [
    {
      id: 'grab',
      name: 'Grab',
      description: 'Food, groceries & rides',
      color: '#00B14F',
      iconEmoji: 'üü¢',
      universalLink: 'https://food.grab.com/vn/en/',
      iosAppStore:
        'https://apps.apple.com/app/grab-taxi-ride-food-delivery/id647268330',
      googlePlay:
        'https://play.google.com/store/apps/details?id=com.grabtaxi.passenger',
    },
    {
      id: 'shopeefood',
      name: 'ShopeeFood',
      description: 'Local restaurants & street food',
      color: '#EE4D2D',
      iconEmoji: 'üü†',
      universalLink: 'https://shopeefood.vn/',
      iosAppStore: 'https://apps.apple.com/app/shopeefood/id1137498563',
      googlePlay:
        'https://play.google.com/store/apps/details?id=com.shopee.shopeefood',
    },
    {
      id: 'baemin',
      name: 'Baemin',
      description: 'Korean-style food delivery',
      color: '#3BC5AA',
      iconEmoji: 'ü©µ',
      universalLink: 'https://baemin.vn/',
      iosAppStore:
        'https://apps.apple.com/app/baemin-food-delivery/id1479498631',
      googlePlay:
        'https://play.google.com/store/apps/details?id=com.vng.baemin',
    },
  ],
  TH: [
    {
      id: 'grab',
      name: 'Grab',
      description: 'Food, groceries & rides',
      color: '#00B14F',
      iconEmoji: 'üü¢',
      universalLink: 'https://food.grab.com/th/en/',
      iosAppStore:
        'https://apps.apple.com/app/grab-taxi-ride-food-delivery/id647268330',
      googlePlay:
        'https://play.google.com/store/apps/details?id=com.grabtaxi.passenger',
    },
    {
      id: 'foodpanda',
      name: 'foodpanda',
      description: 'Food & grocery delivery',
      color: '#D70F64',
      iconEmoji: 'ü©∑',
      universalLink: 'https://www.foodpanda.co.th/',
      iosAppStore:
        'https://apps.apple.com/app/foodpanda-food-delivery/id758103884',
      googlePlay:
        'https://play.google.com/store/apps/details?id=com.global.foodpanda.android',
    },
    {
      id: 'lineman',
      name: 'LINE MAN',
      description: 'Food, parcels & services',
      color: '#00C300',
      iconEmoji: 'üíö',
      universalLink: 'https://lineman.line.me/',
      iosAppStore: 'https://apps.apple.com/app/line-man/id1078271530',
      googlePlay:
        'https://play.google.com/store/apps/details?id=com.linecorp.lineman',
    },
  ],
  // ID (Indonesia), PH (Philippines), MY (Malaysia) can be added later
};

export function getDeliveryApps(countryCode: string): DeliveryApp[] {
  return deliveryAppsRegistry[countryCode?.toUpperCase()] || [];
}
```

2. **Create DeliveryAppsSection.tsx:**
   - Props: `{ countryCode: string; propertyAddress: string; propertyCity?: string }`
   - Call `getDeliveryApps(countryCode)` ‚Äî if empty array, return null (section hidden)
   - Render section header: "Order Food Delivery" with Package/ForkKnife Phosphor icon
   - Subtitle: "Get food delivered to your accommodation"
   - Show "Your address" card with the property address + city, with a "Copy" button that copies to clipboard (navigator.clipboard.writeText) and shows brief "Copied!" feedback
   - Render delivery app cards in a grid (1 column on mobile, 2 on desktop):
     - Card has colored left border (app's brand color, 3px borderLeft matching GRID-01 pattern)
     - App name (bold), description (gray text), emoji as visual indicator
     - "Open App" button ‚Üí links to universalLink (opens in new tab/app)
     - Below cards: small text "Tip: Copy your address above, then paste it in the app"
   - Use Phosphor icons: Copy for copy button, ArrowSquareOut for open-app link
   - Style consistent with existing dashboard cards (rounded-xl, shadow-sm, bg-white)
     </action>
     <verify>
   - delivery-apps-data.ts exports getDeliveryApps function and DeliveryApp type
   - DeliveryAppsSection.tsx renders cards based on country code
   - Returns null when country has no delivery apps configured
   - Has copy-to-clipboard functionality for property address
   - Run: `npx tsc --noEmit --project apps/accommodations/frontend/tsconfig.json 2>&1 | head -30`
     </verify>
     <done>
     Delivery apps data config with VN and TH apps. DeliveryAppsSection renders branded cards with open-app links and copy-address button.
     </done>
     </task>

<task type="auto">
  <name>Task 2: Wire DeliveryAppsSection into guest stay page</name>
  <files>
    apps/accommodations/frontend/app/stay/[code]/page.tsx
  </files>
  <action>
Wire the DeliveryAppsSection into the guest stay dashboard page:

1. Import DeliveryAppsSection component
2. The stay page already has property data with address and country_code from the API. Pass these to DeliveryAppsSection:
   - `countryCode={property.country_code}` (check the PropertyInfo type for exact field name ‚Äî may be `country_code` or `countryCode`)
   - `propertyAddress={property.address}`
   - `propertyCity={property.city}`
3. Place the DeliveryAppsSection AFTER the existing concierge/services sections but BEFORE the footer
4. The component self-hides (returns null) when no apps are available for the country, so it's safe to always render it

Check the PropertyInfo type in @/types/stay.ts to find the exact field names for address, city, and country_code. If country_code is not in PropertyInfo:

- Check the API route that returns property data (/api/stay/[code]/property or similar)
- The accom_properties table has country_code TEXT column
- Add country_code to the SELECT query and PropertyInfo type if missing
  </action>
  <verify> - Stay page imports and renders DeliveryAppsSection - DeliveryAppsSection receives correct props from property data - Section appears in appropriate position on the page - Run: `npx tsc --noEmit --project apps/accommodations/frontend/tsconfig.json 2>&1 | head -30`
  </verify>
  <done>
  Delivery apps section is visible in the guest dashboard for Vietnamese and Thai properties, showing branded app cards with deep-links and address copy functionality.
  </done>
  </task>

</tasks>

<verification>
1. delivery-apps-data.ts has VN and TH delivery app configs
2. DeliveryAppsSection renders branded cards with correct brand colors
3. Copy-address button copies property address to clipboard
4. Open-app buttons link to universal URLs
5. Section is hidden when country has no delivery apps
6. Stay page renders the section with correct property data
7. TypeScript compiles without errors
</verification>

<success_criteria>

- Vietnamese property shows Grab, ShopeeFood, Baemin cards
- Thai property shows Grab, Foodpanda, LINE MAN cards
- Unknown country shows no delivery section (hidden gracefully)
- Property address is copyable with clipboard feedback
- Each app card links to its universal URL
- No TypeScript errors
  </success_criteria>

<output>
After completion, create `.planning/phases/38-guest-lifecycle/38-02-SUMMARY.md`
</output>
