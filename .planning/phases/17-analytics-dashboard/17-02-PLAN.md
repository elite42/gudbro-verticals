---
phase: 17-analytics-dashboard
plan: 02
type: execute
wave: 2
depends_on: ['17-01']
files_modified:
  - apps/backoffice/app/(dashboard)/platform/feedback-analytics/page.tsx
  - apps/backoffice/components/feedback-analytics/AnalyticsDashboard.tsx
  - apps/backoffice/components/layout/Sidebar.tsx
autonomous: true

must_haves:
  truths:
    - 'Admin sees a time-series line chart showing submission volume over configurable time ranges (7d, 30d, 90d, all)'
    - 'Admin sees submission counts grouped by type and by vertical in chart form'
    - 'Admin sees a ranked list of top requested features ordered by submission count'
    - 'Admin sees average processing time and average resolution time as KPI metrics'
    - 'Feedback Analytics page is accessible from the platform sidebar navigation'
  artifacts:
    - path: 'apps/backoffice/app/(dashboard)/platform/feedback-analytics/page.tsx'
      provides: 'Server component page shell for analytics dashboard'
      min_lines: 10
    - path: 'apps/backoffice/components/feedback-analytics/AnalyticsDashboard.tsx'
      provides: 'Client component with charts, KPI cards, time range selector'
      min_lines: 100
  key_links:
    - from: 'AnalyticsDashboard.tsx'
      to: '/api/feedback/analytics/volume'
      via: 'fetch in useEffect triggered by time range change'
      pattern: 'fetch.*analytics/volume'
    - from: 'AnalyticsDashboard.tsx'
      to: '/api/feedback/analytics/summary'
      via: 'fetch in useEffect triggered by time range change'
      pattern: 'fetch.*analytics/summary'
    - from: 'Sidebar.tsx'
      to: '/platform/feedback-analytics'
      via: 'platformNavigation children entry'
      pattern: 'feedback-analytics'
---

<objective>
Build the analytics dashboard page with Recharts charts, KPI cards, and time range selector.

Purpose: Give admins visual insight into feedback volume, distribution, top features, and response performance.
Output: A fully functional analytics page at /platform/feedback-analytics with live data from Plan 01 API routes.
</objective>

<execution_context>
@/Users/gianfrancodagostino/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gianfrancodagostino/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-analytics-dashboard/17-RESEARCH.md
@.planning/phases/17-analytics-dashboard/17-01-SUMMARY.md

# Existing patterns

@apps/backoffice/app/(dashboard)/platform/page.tsx
@apps/backoffice/components/layout/Sidebar.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Recharts and create analytics dashboard</name>
  <files>
    apps/backoffice/app/(dashboard)/platform/feedback-analytics/page.tsx
    apps/backoffice/components/feedback-analytics/AnalyticsDashboard.tsx
  </files>
  <action>
1. Install recharts: `cd apps/backoffice && pnpm add recharts`

2. Create page.tsx as a server component shell:
   - Title "Feedback Analytics"
   - Render the AnalyticsDashboard client component

3. Create AnalyticsDashboard.tsx as a 'use client' component containing ALL dashboard logic in one file (KPI cards, charts, time range selector, top features table). Keep it in one file since the charts are tightly coupled to the same data fetches.

   Structure:
   a. TIME_RANGES constant: [{label: '7 days', value: 7}, {label: '30 days', value: 30}, {label: '90 days', value: 90}, {label: 'All time', value: 0}]
   b. State: selectedDays (default 30), volumeData, summaryData, loading
   c. useEffect: fetch both /api/feedback/analytics/volume?days=X and /api/feedback/analytics/summary?days=X in parallel via Promise.all when selectedDays changes
   d. Loading state: show skeleton placeholders (gray rounded divs with animate-pulse)
   e. Empty state: if no data, show message "No submissions in this time range"

   Layout (top to bottom):
   - Header row: page title + TimeRangeSelector (button group with active state styling)
   - KPI row (4 cards in a grid): Total Submissions, Avg Processing Time (hours), Avg Resolution Time (hours), Top Feature count
     - Use MetricCard pattern from RESEARCH.md (rounded-xl border border-gray-200 bg-white p-6)
     - Show "N/A" for null avgProcessingHours/avgResolutionHours
     - Add tooltip text explaining what each metric means (processing = AI processing time, resolution = task creation to resolution)
   - Volume chart: Recharts LineChart inside rounded-xl card with h3 title "Submission Volume"
     - Use ResponsiveContainer height={300}
     - Line with stroke="#3b82f6", monotone, no dots, activeDot r=4
     - XAxis formatted as M/D, YAxis allowDecimals=false
     - CartesianGrid strokeDasharray="3 3" stroke="#f0f0f0"
   - Two-column row (lg:grid-cols-2, 1 col on mobile):
     - Left: Type Breakdown — Recharts BarChart with bars colored by type (bug=#ef4444, feature_request=#3b82f6, improvement=#8b5cf6, complaint=#f59e0b, praise=#10b981, operational=#6b7280). Use a single Bar with custom cell fill per entry.
     - Right: Vertical Breakdown — Recharts BarChart with single color (#3b82f6), horizontal bars (layout="vertical" for readability)
   - Top Features table: rounded-xl card with h3 "Top Requested Features"
     - Table with columns: Rank (#), Title, Submissions (count), Priority (badge), Status (badge)
     - Show top 10, ordered by submission_count desc (already sorted from API)
     - Priority badges: 1-2 = red (High), 3 = yellow (Medium), 4-5 = green (Low)
     - Status badges matching kanban colors

   IMPORTANT: All Recharts components MUST be inside 'use client' component. Do NOT try to SSR Recharts.
   IMPORTANT: Handle empty data arrays — check length before rendering charts, show empty state instead.
   </action>
   <verify> - `cd apps/backoffice && npx tsc --noEmit --pretty 2>&1 | tail -20` shows no errors - `cd apps/backoffice && npx next build 2>&1 | tail -20` builds successfully
   </verify>
   <done>Analytics dashboard page renders at /platform/feedback-analytics with volume line chart, type bar chart, vertical bar chart, top features table, KPI cards, and time range selector. All charts use Recharts. Empty states handled.</done>
   </task>

<task type="auto">
  <name>Task 2: Add sidebar navigation entry</name>
  <files>apps/backoffice/components/layout/Sidebar.tsx</files>
  <action>
Add "Feedback Analytics" to the platformNavigation children array in Sidebar.tsx.

Find the children array under the Platform navigation item (currently contains: Overview, Merchants, Revenue, Countries, Support).

Add after Support:
{ name: 'Feedback Analytics', href: '/platform/feedback-analytics' }

This ensures the analytics page is discoverable from the sidebar without needing to navigate through the kanban board first.
</action>
<verify> - `grep -n 'feedback-analytics' apps/backoffice/components/layout/Sidebar.tsx` shows the new entry - `cd apps/backoffice && npx tsc --noEmit --pretty 2>&1 | tail -5` shows no errors
</verify>
<done>Sidebar shows "Feedback Analytics" link under Platform section, navigating to /platform/feedback-analytics</done>
</task>

</tasks>

<verification>
- `cd apps/backoffice && npx next build` succeeds
- Page at /platform/feedback-analytics renders without errors
- Sidebar includes Feedback Analytics link
- Time range selector switches between 7d/30d/90d/all and refetches data
- Charts handle empty data gracefully (no NaN labels, no blank charts)
- All four requirements visible: volume chart (FBAN-01), type+vertical breakdown (FBAN-02), top features (FBAN-03), response time KPIs (FBAN-04)
</verification>

<success_criteria>
Admin can navigate to /platform/feedback-analytics from the sidebar, see KPI cards with response time metrics, a submission volume line chart with configurable time range, type and vertical breakdown bar charts, and a ranked top features table. Page handles loading and empty states.
</success_criteria>

<output>
After completion, create `.planning/phases/17-analytics-dashboard/17-02-SUMMARY.md`
</output>
