---
phase: 11-e2e-smoke-tests
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - tests/e2e/verticals/wellness.smoke.spec.ts
  - tests/e2e/verticals/laundry.smoke.spec.ts
  - tests/e2e/verticals/pharmacy.smoke.spec.ts
  - tests/e2e/verticals/workshops.smoke.spec.ts
autonomous: true

must_haves:
  truths:
    - 'Wellness smoke test includes BottomNav link navigation and responsive viewport overflow checks'
    - 'Laundry, pharmacy, and workshops each have a smoke spec covering page load, BottomNav nav, and responsive viewports'
    - 'All 4 specs pass on both mobile and desktop projects'
  artifacts:
    - path: 'tests/e2e/verticals/wellness.smoke.spec.ts'
      provides: 'Updated wellness smoke with BottomNav + viewport tests'
      contains: 'BottomNav links navigate'
    - path: 'tests/e2e/verticals/laundry.smoke.spec.ts'
      provides: 'Laundry smoke tests'
      contains: 'Laundry PWA Smoke'
    - path: 'tests/e2e/verticals/pharmacy.smoke.spec.ts'
      provides: 'Pharmacy smoke tests'
      contains: 'Pharmacy PWA Smoke'
    - path: 'tests/e2e/verticals/workshops.smoke.spec.ts'
      provides: 'Workshops smoke tests'
      contains: 'Workshops PWA Smoke'
  key_links:
    - from: 'tests/e2e/verticals/*.smoke.spec.ts'
      to: 'tests/e2e/shared/fixtures.ts'
      via: 'import { test, expect }'
      pattern: "from '../shared/fixtures'"
    - from: 'tests/e2e/verticals/*.smoke.spec.ts'
      to: 'tests/e2e/shared/vertical-registry.ts'
      via: 'VERTICALS[slug]'
      pattern: "VERTICALS\\."
---

<objective>
Write smoke tests for wellness (update existing), laundry, pharmacy, and workshops -- all link-based BottomNav verticals.

Purpose: Cover 4 of 8 verticals with full smoke test coverage (page load, BottomNav navigation, responsive viewports). These are the simpler link-based verticals where all BottomNav items use `<Link href>`.
Output: 4 smoke spec files (1 updated, 3 new) all passing on mobile + desktop projects.
</objective>

<execution_context>
@/Users/gianfrancodagostino/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gianfrancodagostino/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-e2e-smoke-tests/11-RESEARCH.md

@tests/e2e/shared/fixtures.ts
@tests/e2e/shared/base-pwa-page.ts
@tests/e2e/shared/vertical-registry.ts
@tests/e2e/shared/viewport-helpers.ts
@tests/e2e/verticals/wellness.smoke.spec.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update wellness smoke + create laundry and pharmacy specs</name>
  <files>
    tests/e2e/verticals/wellness.smoke.spec.ts
    tests/e2e/verticals/laundry.smoke.spec.ts
    tests/e2e/verticals/pharmacy.smoke.spec.ts
  </files>
  <action>
**Wellness (UPDATE existing file):** Keep the existing 5 tests. Add two new test blocks:

1. **BottomNav navigation test:** Wellness has 5 links (all nav items including center are Links). After `pwaPage.goto()`, locate `nav a[href]:not([href="#"])`. Assert count > 0. Collect all hrefs. For each href, `page.goto(href)`, wait for `domcontentloaded`, assert `page.url()` contains the href. Known wellness nav hrefs: `/`, `/services`, `/packages`, `/promotions`, `/search`.

2. **Responsive viewport tests:** Loop over 3 viewports `[{name:'mobile',width:375,height:812}, {name:'tablet',width:768,height:1024}, {name:'desktop',width:1280,height:800}]`. For each: `page.setViewportSize()`, `pwaPage.goto()`, `page.waitForLoadState('domcontentloaded')`, evaluate `document.documentElement.scrollWidth > document.documentElement.clientWidth`, assert false.

**Laundry (NEW file):** Create `laundry.smoke.spec.ts` following the full template from research. Use `VERTICALS.laundry`. Laundry has 4 nav links (Home `/`, Services `/services`, Promo `/promotions`, Search `/search`) -- center "Menu" is a button, filter with `a[href]:not([href="#"])`. Include all test blocks: page load, title, console errors, nav visible, BottomNav link navigation, key routes accessible, and 3 responsive viewport tests.

**Pharmacy (NEW file):** Create `pharmacy.smoke.spec.ts`. Use `VERTICALS.pharmacy`. Pharmacy has 5 nav links (all including center "Symptoms" which is a Link to `/search`). Same full template. All 5 are links -- `a[href]:not([href="#"])` will capture all of them.

**Anti-flaky rules (apply to ALL specs):**

- Use `waitForLoadState('domcontentloaded')` NOT `networkidle` for navigation tests (HMR websocket issue)
- The existing `pwaPage.expectNoConsoleErrors()` uses `networkidle` and that is fine since it is specifically waiting for all network to settle before checking errors
- Use `a[href]:not([href="#"])` selector to skip any `href="#"` center buttons
- Use structural assertions only -- no content text assertions
  </action>
  <verify>
  Run each spec individually against running dev servers:

```bash
SKIP_WEBSERVER=1 npx playwright test --project=wellness-mobile tests/e2e/verticals/wellness.smoke.spec.ts
SKIP_WEBSERVER=1 npx playwright test --project=laundry-mobile tests/e2e/verticals/laundry.smoke.spec.ts
SKIP_WEBSERVER=1 npx playwright test --project=pharmacy-mobile tests/e2e/verticals/pharmacy.smoke.spec.ts
```

All tests must pass. If a dev server is not running, start it with `pnpm --filter {pkg} dev` first.
</verify>
<done>
wellness.smoke.spec.ts has 5 original tests + BottomNav navigation test + 3 responsive viewport tests (total ~8 tests).
laundry.smoke.spec.ts and pharmacy.smoke.spec.ts each have ~8 tests covering all 3 categories.
All pass on mobile project.
</done>
</task>

<task type="auto">
  <name>Task 2: Create workshops spec and verify all 4 on desktop</name>
  <files>
    tests/e2e/verticals/workshops.smoke.spec.ts
  </files>
  <action>
**Workshops (NEW file):** Create `workshops.smoke.spec.ts`. Use `VERTICALS.workshops`. Workshops has 5 nav links (all including center "Explore" which is a Link to `/search`). Same full template as pharmacy. All 5 are links.

After creating workshops spec, run ALL 4 specs (wellness, laundry, pharmacy, workshops) on their **desktop** projects to verify they pass at wider viewport too. The BottomNav is `md:hidden` so BottomNav-specific tests should still work because:

- The BottomNav link test uses `nav a[href]` -- if nav is hidden on desktop, the count may be 0. To handle this: the test should use `nav a[href]:not([href="#"])` and if count is 0 on desktop viewport (nav hidden), SKIP the link iteration gracefully. Use a conditional: if count === 0, skip (do not assert > 0 on desktop). OR better: the desktop project uses 1280px viewport where BottomNav may be hidden. The test can check `navLinks.count()` and only iterate if > 0, removing the `expect(count).toBeGreaterThan(0)` hard assertion. Instead, use a soft check: `if (count === 0) return;` (no links visible at this viewport = pass).

**IMPORTANT UPDATE for all 4 specs:** Revisit the BottomNav navigation test in wellness, laundry, pharmacy, workshops. Change the assertion logic to handle desktop gracefully:

```typescript
const count = await navLinks.count();
// On desktop viewport, BottomNav may be hidden (md:hidden)
if (count === 0) return; // No visible nav links at this viewport -- ok
```

This ensures the test passes on both mobile and desktop projects without flakiness.
</action>
<verify>
Run all 4 specs on desktop projects:

```bash
SKIP_WEBSERVER=1 npx playwright test --project=wellness-desktop tests/e2e/verticals/wellness.smoke.spec.ts
SKIP_WEBSERVER=1 npx playwright test --project=laundry-desktop tests/e2e/verticals/laundry.smoke.spec.ts
SKIP_WEBSERVER=1 npx playwright test --project=pharmacy-desktop tests/e2e/verticals/pharmacy.smoke.spec.ts
SKIP_WEBSERVER=1 npx playwright test --project=workshops-desktop tests/e2e/verticals/workshops.smoke.spec.ts
```

All tests pass on desktop projects.
</verify>
<done>
workshops.smoke.spec.ts created with ~8 tests.
All 4 link-based vertical specs pass on BOTH mobile and desktop projects.
BottomNav test gracefully handles hidden nav on desktop viewports.
</done>
</task>

</tasks>

<verification>
- `SKIP_WEBSERVER=1 npx playwright test --project=wellness-mobile --project=wellness-desktop` passes
- `SKIP_WEBSERVER=1 npx playwright test --project=laundry-mobile --project=laundry-desktop` passes
- `SKIP_WEBSERVER=1 npx playwright test --project=pharmacy-mobile --project=pharmacy-desktop` passes
- `SKIP_WEBSERVER=1 npx playwright test --project=workshops-mobile --project=workshops-desktop` passes
- No content-based assertions (no specific text like menu names or page copy)
- All tests use structural assertions (element visibility, counts, URL patterns, overflow checks)
</verification>

<success_criteria>
4 vertical smoke spec files exist with page-load, BottomNav navigation, and responsive viewport tests.
All pass on both mobile and desktop Playwright projects.
Wellness updated from 5 to ~8 tests. Laundry, pharmacy, workshops each have ~8 tests.
</success_criteria>

<output>
After completion, create `.planning/phases/11-e2e-smoke-tests/11-01-SUMMARY.md`
</output>
