---
phase: 06-in-stay-dashboard
plan: 04
type: execute
wave: 3
depends_on: ['06-03']
files_modified:
  - apps/accommodations/frontend/components/stay/ServicesCarousel.tsx
  - apps/accommodations/frontend/components/stay/LocalDeals.tsx
  - apps/accommodations/frontend/components/stay/UsefulNumbers.tsx
  - apps/accommodations/frontend/app/stay/[code]/page.tsx
autonomous: true

must_haves:
  truths:
    - 'Services carousel displays categories and items with formatted prices from API'
    - 'Local deals section shows partner offers with contact/booking actions'
    - 'Useful numbers section displays emergency and city numbers from API'
    - 'All mock data has been replaced with real API calls across the entire dashboard'
    - 'Loading states are handled gracefully for each section (no flash of wrong content)'
    - 'Price formatting uses Intl.NumberFormat with correct currency (VND shows no decimals)'
    - 'Full production build passes with zero TypeScript errors'
  artifacts:
    - path: 'apps/accommodations/frontend/components/stay/ServicesCarousel.tsx'
      provides: 'Services categories with items and prices'
      contains: 'fetchServices'
    - path: 'apps/accommodations/frontend/components/stay/LocalDeals.tsx'
      provides: 'Partner deals with actions'
      contains: 'fetchDeals'
    - path: 'apps/accommodations/frontend/components/stay/UsefulNumbers.tsx'
      provides: 'Emergency and city numbers'
      contains: 'fetchUsefulNumbers'
  key_links:
    - from: 'apps/accommodations/frontend/components/stay/ServicesCarousel.tsx'
      to: '/api/stay/[code]/services'
      via: 'fetchServices from stay-api.ts'
      pattern: 'fetchServices'
    - from: 'apps/accommodations/frontend/components/stay/LocalDeals.tsx'
      to: '/api/stay/[code]/deals'
      via: 'fetchDeals from stay-api.ts'
      pattern: 'fetchDeals'
    - from: 'apps/accommodations/frontend/components/stay/UsefulNumbers.tsx'
      to: '/api/stay/[code]/useful-numbers'
      via: 'fetchUsefulNumbers from stay-api.ts'
      pattern: 'fetchUsefulNumbers'
---

<objective>
Create the remaining data-fetching dashboard components (Services, Deals, Useful Numbers) that each call their own API endpoints, and wire them into the dashboard shell. This completes the full In-Stay Dashboard with all mock data replaced by real API data.

Purpose: These three sections each need independent API calls (they are not part of the verify response). Each component manages its own loading/error/data state, preventing one failed section from breaking the whole dashboard.
Output: 3 new section components + updated dashboard shell composing all 12 sections. Full build verification.
</objective>

<execution_context>
@/Users/gianfrancodagostino/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gianfrancodagostino/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-in-stay-dashboard/06-RESEARCH.md
@.planning/phases/06-in-stay-dashboard/06-CONTEXT.md

Key source files (from Plan 03):
@apps/accommodations/frontend/app/stay/[code]/page.tsx
@apps/accommodations/frontend/types/stay.ts
@apps/accommodations/frontend/lib/stay-api.ts
@apps/accommodations/frontend/hooks/useStaySession.ts

Reference for mock data shapes (to understand what the UI should display):
Read the original monolithic page to see how services, deals, and useful numbers were rendered in the mock.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Services carousel and local deals components</name>
  <files>
    apps/accommodations/frontend/components/stay/ServicesCarousel.tsx
    apps/accommodations/frontend/components/stay/LocalDeals.tsx
  </files>
  <action>
1. Create components/stay/ServicesCarousel.tsx:
   - 'use client' with own useEffect data fetch
   - Props: { bookingCode: string, token: string }
   - On mount: call fetchServices(bookingCode, token) from stay-api.ts
   - Display service categories as horizontal scroll sections (carousel pattern)
   - Each category shows name + its service items
   - Each item shows: name, description (if available), formatted price
   - Price formatting: use Intl.NumberFormat('en', { style: 'currency', currency: item.currency })
   - IMPORTANT: prices are stored as minor currency units (integers). For VND (0 decimal currency), 65000 = 65,000 VND (direct). For USD (2 decimal currency), 800 = $8.00 (divide by 100). Check if currency has 0 decimal places (VND, JPY, KRW) and format accordingly.
   - Loading state: show skeleton cards with animate-pulse
   - Error state: show "Couldn't load services" message
   - Empty state: return null (no services configured = hide section)
   - View-only: no ordering, no add-to-cart

2. Create components/stay/LocalDeals.tsx:
   - 'use client' with own useEffect data fetch
   - Props: { bookingCode: string, token: string }
   - On mount: call fetchDeals(bookingCode, token) from stay-api.ts
   - Display deals as a list of cards (NOT tabbed - API returns flat array per RESEARCH.md)
   - Each deal card shows: partner/merchant name, description, discount percentage, validity period
   - Action button: if deal has contact info, open WhatsApp or link. Use deal's merchant data.
   - Loading state: skeleton cards
   - Error state: "Couldn't load deals" message
   - Empty state: return null (no deals = hide section)
   - Match the visual style from the mock page's deals section

Both components fetch independently and fail independently. One section failing does NOT affect the other.
</action>
<verify>
Run `cd /Users/gianfrancodagostino/Desktop/gudbro-verticals && pnpm --filter accommodations-frontend build` and confirm build passes.
</verify>
<done>Services carousel displays categories with items and formatted prices. Local deals shows partner offers with contact actions. Both handle loading/error/empty states independently. Prices formatted correctly with Intl.NumberFormat.</done>
</task>

<task type="auto">
  <name>Task 2: Useful numbers component + final dashboard wiring + build verification</name>
  <files>
    apps/accommodations/frontend/components/stay/UsefulNumbers.tsx
    apps/accommodations/frontend/app/stay/[code]/page.tsx
  </files>
  <action>
1. Create components/stay/UsefulNumbers.tsx:
   - 'use client' with own useEffect data fetch
   - Props: { bookingCode: string, token: string }
   - On mount: call fetchUsefulNumbers(bookingCode, token) from stay-api.ts
   - Display three sections:
     a) Emergency numbers (police, ambulance, fire) - prominent, red/orange accent
     b) City numbers (tourist police, hospital, taxi, etc.) - organized by category
     c) Property contact (host name + phone) - at bottom
   - Each number has a "Call" button: tel:{number} link
   - Loading state: skeleton
   - Error state: hide section (useful numbers failing shouldn't alarm guests)
   - Empty state: return null

2. Update dashboard shell (app/stay/[code]/page.tsx):
   - Replace placeholder divs for Services, Deals, and UsefulNumbers with the real components
   - Import ServicesCarousel, LocalDeals, UsefulNumbers from components/stay/
   - Pass bookingCode and token as props to each
   - Ensure the full component order matches the CONTEXT.md dashboard layout:
     DashboardHeader -> WifiCard -> WelcomeCard -> VisaStatusCard -> QuickActions -> ServicesCarousel -> LocalDeals -> UsefulNumbers -> ReturnGuestBanner -> CheckoutInfo -> ContactSheet
   - Verify NO mock data remains anywhere in the dashboard or its components
   - Verify all imports resolve correctly

3. Final build verification:
   - Run full production build
   - Confirm all routes compile
   - Confirm no TypeScript errors
   - Count total files in components/stay/ directory (should be 11: DashboardHeader, WifiCard, WelcomeCard, VisaStatusCard, QuickActions, ServicesCarousel, LocalDeals, UsefulNumbers, ReturnGuestBanner, CheckoutInfo, ContactSheet)
     </action>
     <verify>
     Run `cd /Users/gianfrancodagostino/Desktop/gudbro-verticals && pnpm --filter accommodations-frontend build` and confirm:

- Build passes with zero TypeScript errors
- All dashboard routes compile as dynamic routes
- No mock data in any component (grep for hardcoded strings from the original mock)
  Run `ls /Users/gianfrancodagostino/Desktop/gudbro-verticals/apps/accommodations/frontend/components/stay/` to confirm all 11 components exist.
  Run `wc -l /Users/gianfrancodagostino/Desktop/gudbro-verticals/apps/accommodations/frontend/app/stay/\[code\]/page.tsx` to confirm dashboard is under 200 lines.
  </verify>
  <done>All 11 dashboard section components exist and are wired to real API data. Dashboard shell is under 200 lines (was 1387). Zero mock data remains. Services show formatted prices, deals show partner offers, useful numbers show emergency/city contacts. Full production build passes with zero TypeScript errors. Phase 6 frontend integration is complete.</done>
  </task>

</tasks>

<verification>
- 11 component files in components/stay/
- Dashboard page under 200 lines
- Services fetch from /api/stay/[code]/services and display with formatted prices
- Deals fetch from /api/stay/[code]/deals and display with actions
- Useful numbers fetch from /api/stay/[code]/useful-numbers and display with call buttons
- No hardcoded mock data anywhere in dashboard or components
- Each section handles loading/error/empty independently
- `pnpm --filter accommodations-frontend build` succeeds with zero errors
</verification>

<success_criteria>

- ALL 10 Phase 6 success criteria from ROADMAP.md are met:
  1. Booking verification screen works (Plan 02)
  2. WiFi card with copy-to-clipboard (Plan 03)
  3. Stay summary with countdown (Plan 03)
  4. Services with prices (this plan)
  5. Local deals with actions (this plan)
  6. Contact host WhatsApp (Plan 03)
  7. Checkout info (Plan 03)
  8. All mock data replaced (this plan - final verification)
  9. Loading states handled (all plans)
  10. Multi-language: English minimum (all text from API, English seed data)
- Full production build passes
- Zero TypeScript errors
  </success_criteria>

<output>
After completion, create `.planning/phases/06-in-stay-dashboard/06-04-SUMMARY.md`
</output>
